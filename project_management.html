<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°ˆæ¡ˆç®¡ç†ç³»çµ± - ä½ä½æœ¨è³¢å®¤å…§è£ä¿®è¨­è¨ˆæœƒè¨ˆç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', 'PingFang TC', Arial, sans-serif;
        }
        
        body {
            background: #f8fafc;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* å°èˆªåˆ— */
        .navbar {
            background: white;
            padding: 12px 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }
        
        .nav-title {
            font-size: 18px;
            color: #1e293b;
            font-weight: 600;
        }
        
        .nav-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            color: #374151;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .btn:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
            border: none;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .user-info {
            background: #f9fafb;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            color: #374151;
        }
        
        /* ä¸»å®¹å™¨ */
        .container {
            display: flex;
            min-height: calc(100vh - 65px);
        }
        
        /* å´é‚Šæ¬„ */
        .sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid #e2e8f0;
            padding: 20px 0;
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 20px;
        }
        
        .sidebar-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }
        
        .sidebar-subtitle {
            font-size: 14px;
            color: #64748b;
            margin-top: 4px;
        }
        
        .menu-section {
            margin-bottom: 20px;
        }
        
        .menu-section-title {
            padding: 0 20px 8px;
            font-size: 12px;
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #475569;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            position: relative;
        }
        
        .menu-item:hover {
            background: #f8fafc;
            color: #1e293b;
        }
        
        .menu-item.active {
            background: #eff6ff;
            color: #2563eb;
            border-left-color: #2563eb;
        }
        
        .menu-icon {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }
        
        .menu-text {
            font-size: 14px;
            font-weight: 500;
            flex: 1;
        }
        
        .menu-badge {
            background: #dc2626;
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
            margin-left: auto;
        }
        
        .menu-badge.info {
            background: #3b82f6;
        }
        
        .menu-badge.success {
            background: #10b981;
        }
        
        .menu-badge.warning {
            background: #f59e0b;
        }
        
        /* å¹´ä»½æ‘ºç–Šé¸å–® */
        .year-group {
            margin-bottom: 10px;
        }
        
        .year-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        
        .year-header:hover {
            background: #f1f5f9;
        }
        
        .year-toggle {
            font-size: 12px;
            transition: transform 0.2s;
        }
        
        .year-toggle.expanded {
            transform: rotate(90deg);
        }
        
        .year-content {
            display: none;
            background: #fafbfc;
        }
        
        .year-content.expanded {
            display: block;
        }
        
        .status-group {
            padding-left: 10px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }
        
        .status-item:hover {
            background: #f1f5f9;
            color: #374151;
        }
        
        .status-item.active {
            background: #dbeafe;
            color: #2563eb;
            font-weight: 500;
        }
        
        .status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .status-icon.active { background: #10b981; }
        .status-icon.completed { background: #3b82f6; }
        .status-icon.pending { background: #f59e0b; }
        
        /* ä¸»å…§å®¹å€ */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            min-width: 0;
        }
        
        /* é é¢æ¨™é¡Œ */
        .page-header {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .page-subtitle {
            font-size: 14px;
            color: #64748b;
        }
        
        .page-actions {
            display: flex;
            gap: 10px;
        }
        
        /* çµ±è¨ˆå¡ç‰‡ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .stat-icon.blue { background: #dbeafe; color: #2563eb; }
        .stat-icon.green { background: #d1fae5; color: #059669; }
        .stat-icon.yellow { background: #fef3c7; color: #d97706; }
        .stat-icon.purple { background: #ede9fe; color: #7c3aed; }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 8px;
        }
        
        .stat-change {
            font-size: 12px;
            font-weight: 500;
        }
        
        .stat-change.positive { color: #059669; }
        .stat-change.negative { color: #dc2626; }
        .stat-change.warning { color: #d97706; }
        
        /* çµ±è¨ˆå¡ç‰‡å°ˆæ¡ˆåˆ—è¡¨ */
        .stat-projects {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }
        
        .stat-project-item {
            font-size: 12px;
            color: #475569;
            padding: 4px 8px;
            margin: 2px 0;
            background: #f8fafc;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid #3b82f6;
        }
        
        .stat-project-item:hover {
            background: #e2e8f0;
            color: #1e293b;
            transform: translateX(2px);
        }
        
        .stat-project-more {
            font-size: 11px;
            color: #94a3b8;
            text-align: center;
            padding: 4px;
            font-style: italic;
        }
        
        /* å°ˆæ¡ˆè¡¨æ ¼ */
        .project-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .table-header {
            padding: 20px 24px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }
        
        .table-content {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
            white-space: nowrap;
        }
        
        th {
            background: #f8fafc;
            font-size: 13px;
            font-weight: 600;
            color: #475569;
        }
        
        td {
            font-size: 14px;
            color: #1e293b;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .status-active { background: #dcfce7; color: #166534; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-completed { background: #dbeafe; color: #1e40af; }
        .status-review { background: #e0e7ff; color: #4338ca; }
        .status-approved { background: #dcfce7; color: #166534; }
        .status-rejected { background: #fee2e2; color: #991b1b; }
        
        .progress-bar {
            width: 80px;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 4px;
        }
        
        .progress-fill {
            height: 100%;
            background: #10b981;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            font-size: 11px;
            color: #64748b;
        }
        
        /* å°ˆæ¡ˆè©³æƒ…æ¨£å¼ */
        .project-detail-container {
            display: none;
        }
        
        .project-detail-container.active {
            display: block;
        }
        
        .project-header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }
        
        .project-title-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }
        
        .project-title {
            font-size: 28px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .project-code {
            color: #64748b;
            font-size: 16px;
        }
        
        .project-status {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-badge-large {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* è³‡è¨Šç¶²æ ¼ */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 20px;
        }
        
        .info-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .info-label {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .info-value {
            color: #1e293b;
            font-size: 16px;
            font-weight: 600;
        }
        
        .info-value.amount {
            color: #0891b2;
            font-size: 18px;
        }
        
        /* é€²åº¦æ¢ */
        .progress-section {
            margin-top: 20px;
        }
        
        .progress-bar-large {
            width: 100%;
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .progress-fill-large {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 8px;
            font-size: 14px;
            color: #475569;
        }
        
        /* æ¨™ç±¤é  */
        .tabs-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }
        
        .tabs-nav {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 16px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
            position: relative;
            min-width: fit-content;
        }
        
        .tab-btn:hover {
            background: #f1f5f9;
            color: #475569;
        }
        
        .tab-btn.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: white;
        }
        
        .tab-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #dc2626;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 16px;
            text-align: center;
        }
        
        .tab-content {
            padding: 30px;
            min-height: 400px;
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .tab-panel h3 {
            color: #1e293b;
            font-size: 18px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .tab-panel p {
            color: #64748b;
            line-height: 1.6;
        }
        
        /* å…§å®¹é¡¯ç¤ºæ§åˆ¶ */
        .content-page {
            display: none;
        }
        
        .content-page.active {
            display: block;
        }
        
        /* å¯©æ ¸ç›¸é—œæ¨£å¼ */
        .approval-item {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }
        
        .approval-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .approval-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .approval-info {
            flex: 1;
        }
        
        .approval-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
        }
        
        .approval-details {
            font-size: 13px;
            color: #64748b;
        }
        
        .approval-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
            border: none;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
            border: none;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
            border: none;
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 1024px) {
            .sidebar {
                width: 280px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 300px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .navbar {
                padding: 10px 15px;
            }
            
            .page-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .project-title-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .table-content {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px 12px;
            }
            
            .tabs-nav {
                flex-wrap: nowrap;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-left">
            <div class="logo">ä½</div>
            <div class="nav-title">å°ˆæ¡ˆç®¡ç†ç³»çµ±</div>
        </div>
        <div class="nav-right">
            <button class="btn" onclick="goBack()">è¿”å›ä¸»æ§åˆ¶å°</button>
            <button class="btn btn-primary" onclick="goHome()">ä¸»ç›®éŒ„</button>
            <span class="user-info" id="navUserInfo">ç®¡ç†è€…</span>
            <button class="btn" onclick="logout()">ç™»å‡º</button>
        </div>
    </nav>

    <div class="container">
        <!-- å´é‚Šæ¬„ -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">å°ˆæ¡ˆç®¡ç†ç³»çµ±</div>
                <div class="sidebar-subtitle">ä½ä½æœ¨è³¢æœƒè¨ˆç³»çµ± v2.0</div>
            </div>
            
            <div class="menu-section">
                <div class="menu-section-title">ç¸½è¦½</div>
                <div class="menu-item active" onclick="showPage('dashboard')">
                    <div class="menu-icon">ğŸ“Š</div>
                    <div class="menu-text">å„€è¡¨æ¿</div>
                </div>
                <div class="menu-item" onclick="showPage('projects')">
                    <div class="menu-icon">ğŸ“‹</div>
                    <div class="menu-text">æˆ‘çš„å°ˆæ¡ˆ</div>
                    <div class="menu-badge" id="myProjectsBadge">0</div>
                </div>
            </div>
            
            <!-- å°ˆæ¡ˆæ­·å²æª”æ¡ˆ -->
            <div class="menu-section">
                <div class="menu-section-title">å°ˆæ¡ˆæ­·å²æª”æ¡ˆ</div>
                <div id="yearGroupsContainer">
                    <!-- å‹•æ…‹ç”Ÿæˆå¹´ä»½çµ„ -->
                </div>
            </div>
            
            <div class="menu-section" id="adminSection">
                <div class="menu-section-title">ç®¡ç†åŠŸèƒ½</div>
                <div class="menu-item" onclick="showPage('allProjects')">
                    <div class="menu-icon">ğŸ“‚</div>
                    <div class="menu-text">æ‰€æœ‰å°ˆæ¡ˆ</div>
                    <div class="menu-badge info" id="allProjectsBadge">0</div>
                </div>
                <div class="menu-item" onclick="showPage('approval')">
                    <div class="menu-icon">âœ…</div>
                    <div class="menu-text">å¯©æ ¸ä¸­å¿ƒ</div>
                    <div class="menu-badge" id="approvalBadge">0</div>
                </div>
                <div class="menu-item" onclick="showPage('assignment')">
                    <div class="menu-icon">ğŸ‘¥</div>
                    <div class="menu-text">å°ˆæ¡ˆåˆ†æ´¾</div>
                </div>
            </div>
        </div>
        
        <!-- ä¸»å…§å®¹å€ -->
        <div class="main-content">
            <!-- å„€è¡¨æ¿å…§å®¹ -->
            <div id="dashboardContent" class="content-page active">
                <div class="page-header">
                    <div>
                        <div class="page-title">å·¥ç¨‹é€²åº¦ç¸½è¦½</div>
                        <div class="page-subtitle">å³æ™‚ç›£æ§å°ˆæ¡ˆé€²åº¦èˆ‡å€‹äººç¸¾æ•ˆæ•¸æ“š</div>
                    </div>
                    <div class="page-actions" id="dashboardActions">
                        <button class="btn btn-primary" onclick="quickAction('newProject')">æ–°å¢å°ˆæ¡ˆ</button>
                    </div>
                </div>
                
                <!-- çµ±è¨ˆå¡ç‰‡ -->
                <div class="stats-grid" id="statsGrid">
                    <!-- å‹•æ…‹ç”Ÿæˆçµ±è¨ˆå¡ç‰‡ -->
                </div>
                
                <!-- å°ˆæ¡ˆåˆ—è¡¨ -->
                <div class="project-table">
                    <div class="table-header">
                        <div class="table-title">æœ€è¿‘å°ˆæ¡ˆ</div>
                    </div>
                    
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>å°ˆæ¡ˆç·¨è™Ÿ</th>
                                    <th>å°ˆæ¡ˆåç¨±</th>
                                    <th>å®¢æˆ¶</th>
                                    <th>é–‹å§‹æ—¥æœŸ</th>
                                    <th>é è¨ˆå®Œå·¥</th>
                                    <th>é€²åº¦</th>
                                    <th>ç‹€æ…‹</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="recentProjectsList">
                                <!-- å‹•æ…‹ç”Ÿæˆå°ˆæ¡ˆåˆ—è¡¨ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- æˆ‘çš„å°ˆæ¡ˆå…§å®¹ -->
            <div id="projectsContent" class="content-page">
                <div class="page-header">
                    <div>
                        <div class="page-title">æˆ‘çš„å°ˆæ¡ˆ</div>
                        <div class="page-subtitle">ç®¡ç†æ‚¨è² è²¬çš„å°ˆæ¡ˆé€²åº¦èˆ‡å·¥ä½œå…§å®¹</div>
                    </div>
                </div>
                
                <div class="project-table">
                    <div class="table-header">
                        <div class="table-title">å°ˆæ¡ˆåˆ—è¡¨</div>
                    </div>
                    
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>å°ˆæ¡ˆç·¨è™Ÿ</th>
                                    <th>å°ˆæ¡ˆåç¨±</th>
                                    <th>å®¢æˆ¶</th>
                                    <th>é–‹å§‹æ—¥æœŸ</th>
                                    <th>é è¨ˆå®Œå·¥</th>
                                    <th>é€²åº¦</th>
                                    <th>ç‹€æ…‹</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="myProjectsList">
                                <!-- å‹•æ…‹ç”Ÿæˆå°ˆæ¡ˆåˆ—è¡¨ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- å¹´ä»½ç‹€æ…‹å°ˆæ¡ˆåˆ—è¡¨ -->
            <div id="yearStatusContent" class="content-page">
                <div class="page-header">
                    <div>
                        <div class="page-title" id="yearStatusTitle">å°ˆæ¡ˆåˆ—è¡¨</div>
                        <div class="page-subtitle" id="yearStatusSubtitle">ä¾å¹´ä»½å’Œç‹€æ…‹ç¯©é¸çš„å°ˆæ¡ˆ</div>
                    </div>
                    <div class="page-actions">
                        <button class="btn" onclick="showPage('dashboard')">è¿”å›ç¸½è¦½</button>
                    </div>
                </div>
                
                <div class="project-table">
                    <div class="table-header">
                        <div class="table-title" id="yearStatusTableTitle">å°ˆæ¡ˆåˆ—è¡¨</div>
                    </div>
                    
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>å°ˆæ¡ˆç·¨è™Ÿ</th>
                                    <th>å°ˆæ¡ˆåç¨±</th>
                                    <th>å®¢æˆ¶</th>
                                    <th>é–‹å§‹æ—¥æœŸ</th>
                                    <th>å®Œå·¥æ—¥æœŸ</th>
                                    <th>é€²åº¦</th>
                                    <th>ç‹€æ…‹</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="yearStatusProjectsList">
                                <!-- å‹•æ…‹ç”Ÿæˆå¹´ä»½ç‹€æ…‹å°ˆæ¡ˆåˆ—è¡¨ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- å¯©æ ¸ä¸­å¿ƒå…§å®¹ -->
            <div id="approvalContent" class="content-page">
                <div class="page-header">
                    <div>
                        <div class="page-title">å¯©æ ¸ä¸­å¿ƒ</div>
                        <div class="page-subtitle">è™•ç†å°ˆæ¡ˆç›¸é—œçš„å¯©æ ¸äº‹é …</div>
                    </div>
                    <div class="page-actions">
                        <button class="btn" onclick="showPage('dashboard')">è¿”å›ç¸½è¦½</button>
                    </div>
                </div>
                
                <div class="project-table">
                    <div class="table-header">
                        <div class="table-title">å¾…å¯©æ ¸é …ç›®</div>
                    </div>
                    
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>ç”³è«‹é¡å‹</th>
                                    <th>å°ˆæ¡ˆåç¨±</th>
                                    <th>ç”³è«‹äºº</th>
                                    <th>ç”³è«‹æ™‚é–“</th>
                                    <th>é‡‘é¡</th>
                                    <th>ç‹€æ…‹</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="approvalList">
                                <!-- å‹•æ…‹ç”Ÿæˆå¯©æ ¸åˆ—è¡¨ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- å°ˆæ¡ˆè©³æƒ…å…§å®¹ -->
            <div id="projectDetailContent" class="content-page">
                <!-- å°ˆæ¡ˆæ¨™é¡Œå€ -->
                <div class="project-header">
                    <div class="project-title-row">
                        <div>
                            <div class="project-title" id="detailProjectTitle">å°ˆæ¡ˆåç¨±</div>
                            <div class="project-code" id="detailProjectCode">å°ˆæ¡ˆç·¨è™Ÿï¼š</div>
                        </div>
                        <div class="project-status">
                            <div class="status-badge-large status-active" id="detailProjectStatus">æ–½å·¥ä¸­</div>
                        </div>
                    </div>
                    
                    <div class="info-grid" id="detailInfoGrid">
                        <!-- å‹•æ…‹ç”Ÿæˆå°ˆæ¡ˆåŸºæœ¬è³‡è¨Š -->
                    </div>
                    
                    <div class="progress-section">
                        <div class="info-label">å·¥ç¨‹é€²åº¦</div>
                        <div class="progress-bar-large">
                            <div class="progress-fill-large" id="detailProgressFill" style="width: 68%;"></div>
                        </div>
                        <div class="progress-text" id="detailProgressText">68% å®Œæˆ (æŒ‰é€²åº¦åŸ·è¡Œä¸­)</div>
                    </div>
                </div>

                <!-- æ¨™ç±¤é å®¹å™¨ -->
                <div class="tabs-container">
                    <div class="tabs-nav">
                        <button class="tab-btn active" onclick="switchTab(event, 'overview')">
                            å°ˆæ¡ˆæ¦‚æ³
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'contracts')">
                            åˆç´„ç®¡ç†
                            <span class="tab-badge">1</span>
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'progress')">
                            å·¥ç¨‹é€²åº¦
                            <span class="tab-badge">3</span>
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'materials')">
                            ææ–™æ¡è³¼
                            <span class="tab-badge">2</span>
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'finance')">
                            è²¡å‹™ç®¡ç†
                            <span class="tab-badge">1</span>
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'changes')">
                            è¨­è¨ˆè®Šæ›´
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'drawings')">
                            åœ–é¢è³‡æ–™
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'timefiles')">
                            å·¥æ™‚æ–‡ä»¶
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'bonus')">
                            å·¥ä½œæ¯”ä¾‹èˆ‡çé‡‘
                        </button>
                    </div>
                    
                    <div class="tab-content">
                        <!-- å°ˆæ¡ˆæ¦‚æ³ -->
                        <div id="overview" class="tab-panel active">
                            <h3>å°ˆæ¡ˆåŸºæœ¬è³‡è¨Š</h3>
                            <p>é€™è£¡é¡¯ç¤ºå°ˆæ¡ˆçš„åŸºæœ¬æ¦‚æ³ï¼ŒåŒ…æ‹¬å°ˆæ¡ˆæè¿°ã€è¨­è¨ˆç†å¿µã€å°ˆæ¡ˆåœ°å€ã€æ™‚ç¨‹è¦åŠƒç­‰è©³ç´°è³‡è¨Šã€‚</p>
                        </div>
                        
                        <!-- åˆç´„ç®¡ç† -->
                        <div id="contracts" class="tab-panel">
                            <h3>åˆç´„è³‡è¨Š</h3>
                            <p>é€™è£¡ç®¡ç†å°ˆæ¡ˆçš„åˆç´„è³‡æ–™ï¼ŒåŒ…æ‹¬ä¸»åˆç´„è³‡æ–™ã€ä»˜æ¬¾éšæ®µæ˜ç´°ã€åˆç´„è®Šæ›´è¨˜éŒ„ç­‰ã€‚</p>
                        </div>
                        
                        <!-- å·¥ç¨‹é€²åº¦ -->
                        <div id="progress" class="tab-panel">
                            <h3>å·¥ç¨‹é€²åº¦è¿½è¹¤</h3>
                            <p>é€™è£¡è¿½è¹¤å„å·¥ç¨‹é …ç›®çš„é€²åº¦ï¼ŒåŒ…æ‹¬æ‹†é™¤å·¥ç¨‹ã€æ°´é›»å·¥ç¨‹ã€æ³¥ä½œå·¥ç¨‹ã€æœ¨ä½œå·¥ç¨‹ã€æ²¹æ¼†å·¥ç¨‹ç­‰å„éšæ®µé€²åº¦ã€‚</p>
                        </div>
                        
                        <!-- ææ–™æ¡è³¼ -->
                        <div id="materials" class="tab-panel">
                            <h3>ææ–™æ¡è³¼æ¸…å–®</h3>
                            <p>é€™è£¡ç®¡ç†å°ˆæ¡ˆæ‰€éœ€çš„ææ–™æ¡è³¼ï¼ŒåŒ…æ‹¬ä¸»è¦ææ–™æ¸…å–®ã€å» å•†å ±åƒ¹æ¯”è¼ƒã€æ¡è³¼é€²åº¦è¿½è¹¤ç­‰ã€‚</p>
                        </div>
                        
                        <!-- è²¡å‹™ç®¡ç† -->
                        <div id="finance" class="tab-panel">
                            <h3>è«‹æ¬¾æ”¶æ¬¾è¨˜éŒ„</h3>
                            <p>é€™è£¡ç®¡ç†å°ˆæ¡ˆçš„è²¡å‹™ç‹€æ³ï¼ŒåŒ…æ‹¬è«‹æ¬¾æ˜ç´°ã€æ”¶æ¬¾è¨˜éŒ„ã€æ”¯å‡ºè²»ç”¨è¨˜éŒ„ã€è²¡å‹™ç¸½è¦½ç­‰ã€‚</p>
                        </div>
                        
                        <!-- è¨­è¨ˆè®Šæ›´ -->
                        <div id="changes" class="tab-panel">
                            <h3>è¨­è¨ˆè®Šæ›´è¨˜éŒ„</h3>
                            <p>é€™è£¡è¨˜éŒ„å°ˆæ¡ˆçš„è¨­è¨ˆè®Šæ›´æ­·å²ï¼ŒåŒ…æ‹¬è®Šæ›´åŸå› ã€é‡‘é¡å½±éŸ¿ã€å·¥æœŸå½±éŸ¿ã€è®Šæ›´å½±éŸ¿åˆ†æç­‰ã€‚</p>
                        </div>
                        
                        <!-- åœ–é¢è³‡æ–™ -->
                        <div id="drawings" class="tab-panel">
                            <h3>è¨­è¨ˆåœ–é¢è³‡æ–™</h3>
                            <p>é€™è£¡ç®¡ç†å°ˆæ¡ˆçš„è¨­è¨ˆåœ–é¢ï¼ŒåŒ…æ‹¬å¹³é¢é…ç½®åœ–ã€ç«‹é¢åœ–ã€å¤©èŠ±æ¿åœ–ã€3Dæ¨¡å‹ã€æ•ˆæœåœ–ã€æ–½å·¥åœ–èªªç­‰å„é¡åœ–é¢è³‡æ–™ã€‚</p>
                        </div>
                        
                        <!-- å·¥æ™‚æ–‡ä»¶ -->
                        <div id="timefiles" class="tab-panel">
                            <h3>å·¥ä½œæ™‚æ•¸çµ±è¨ˆ</h3>
                            <p>é€™è£¡çµ±è¨ˆå°ˆæ¡ˆçš„å·¥ä½œæ™‚æ•¸ï¼ŒåŒ…æ‹¬ç¸½å·¥æ™‚çµ±è¨ˆã€äººå“¡å·¥æ™‚åˆ†é…ã€æœ¬æœˆå·¥æ™‚ã€å·¥ä½œæ—¥èªŒç­‰ã€‚</p>
                        </div>
                        
                        <!-- å·¥ä½œæ¯”ä¾‹èˆ‡çé‡‘ -->
                        <div id="bonus" class="tab-panel">
                            <h3>å·¥ä½œæ¯”ä¾‹èˆ‡çé‡‘åˆ†é…</h3>
                            <p>é€™è£¡ç®¡ç†å°ˆæ¡ˆçš„å·¥ä½œæ¯”ä¾‹åˆ†é…å’Œçé‡‘è¨ˆç®—ï¼ŒåŒ…æ‹¬è¨­è¨ˆå¸«å·¥ä½œæ¯”ä¾‹ã€åŠ©ç†å·¥ä½œæ¯”ä¾‹ã€å°ˆæ¡ˆç¶“ç†æ¯”ä¾‹ã€çé‡‘è¨ˆç®—å…¬å¼ã€ç¸¾æ•ˆè©•ä¼°ç­‰ã€‚</p>
                        </div>
                    </div>
                </div>
                
                <div class="page-actions" style="margin-top: 20px;">
                    <button class="btn" onclick="showPage('dashboard')">è¿”å›ç¸½è¦½</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨åŸŸè®Šæ•¸
        let currentUser = null;
        let userPermissions = {};
        let currentProjectId = null;
        
        // å¹´ä»½ç¯„åœé…ç½® (æ–¹ä¾¿æœªä¾†æ“´å±•)
        const YEAR_RANGE = {
            start: 2021,
            end: 2026
        };
        
        // å°ˆæ¡ˆè³‡æ–™ (æ“´å±•åˆ°2021-2026å¹´)
        const projectsData = [
            // 2026å¹´å°ˆæ¡ˆ (é è¨ˆ)
            {
                id: 'PRJ-2026-001',
                name: 'æœªä¾†ç§‘æŠ€è¾¦å…¬å®¤',
                customer: 'ç§‘æŠ€å…¬å¸',
                designer: 'designer01',
                designerName: 'ç‹ç¾çªˆ',
                startDate: '2026-01-15',
                endDate: '2026-07-30',
                progress: 0,
                status: 'pending',
                statusText: 'å¾…çºŒ',
                year: '2026'
            },
            // 2025å¹´å°ˆæ¡ˆ
            {
                id: 'PRJ-2025-001',
                name: 'å°ä¸­å»ºè¨­è¾¦å…¬å®¤è£ä¿®',
                customer: 'å¼µå…ˆç”Ÿ',
                designer: 'designer01',
                designerName: 'ç‹ç¾çªˆ',
                startDate: '2025-01-15',
                endDate: '2025-06-30',
                progress: 75,
                status: 'active',
                statusText: 'é€²è¡Œä¸­',
                year: '2025'
            },
            {
                id: 'PRJ-2025-002',
                name: 'å…§æ¹–ä½å®…ç¿»æ–°è¨­è¨ˆ',
                customer: 'æ—å°å§',
                designer: 'designer02',
                designerName: 'æå¿—è±ª',
                startDate: '2025-02-01',
                endDate: '2025-05-15',
                progress: 45,
                status: 'active',
                statusText: 'é€²è¡Œä¸­',
                year: '2025'
            },
            {
                id: 'PRJ-2025-003',
                name: 'å¤§å®‰ä½å®…è£ä¿®',
                customer: 'é™³å¥³å£«',
                designer: 'designer01',
                designerName: 'ç‹ç¾çªˆ',
                startDate: '2025-01-20',
                endDate: '2025-04-20',
                progress: 30,
                status: 'active',
                statusText: 'é€²è¡Œä¸­',
                year: '2025'
            },
            {
                id: 'PRJ-2025-005',
                name: 'æ¾å±±å€å•†è¾¦è¨­è¨ˆ',
                customer: 'å•†è¾¦æ¥­ä¸»',
                designer: 'designer02',
                designerName: 'æå¿—è±ª',
                startDate: '2025-01-05',
                endDate: '2025-03-15',
                progress: 100,
                status: 'completed',
                statusText: 'å·²å®Œæˆ',
                year: '2025'
            },
            // 2024å¹´å°ˆæ¡ˆ
            {
                id: 'PRJ-2024-015',
                name: 'å—æ¸¯è¾¦å…¬å®¤è¨­è¨ˆ',
                customer: 'ç‹è‘£äº‹é•·',
                designer: 'designer01',
                designerName: 'ç‹ç¾çªˆ',
                startDate: '2024-09-01',
                endDate: '2024-12-30',
                progress: 100,
                status: 'completed',
                statusText: 'å·²å®Œæˆ',
                year: '2024'
            },
            {
                id: 'PRJ-2024-016',
                name: 'æ¿æ©‹ä½å®…ç¿»ä¿®',
                customer: 'é»ƒå°å§',
                designer: 'designer02',
                designerName: 'æå¿—è±ª',
                startDate: '2024-10-15',
                endDate: '2024-12-20',
                progress: 100,
                status: 'completed',
                statusText: 'å·²å®Œæˆ',
                year: '2024'
            },
            {
                id: 'PRJ-2024-017',
                name: 'ä¸­å±±å€å’–å•¡å»³',
                customer: 'å’–å•¡åº—è€é—†',
                designer: 'designer03',
                designerName: 'å¼µé›…å©·',
                startDate: '2024-11-01',
                endDate: '2025-02-28',
                progress: 20,
                status: 'pending',
                statusText: 'å¾…çºŒ',
                year: '2024'
            },
            {
                id: 'PRJ-2024-018',
                name: 'å¤©æ¯åˆ¥å¢…è¨­è¨ˆ',
                customer: 'è±ªå®…æ¥­ä¸»',
                designer: 'designer01',
                designerName: 'ç‹ç¾çªˆ',
                startDate: '2024-12-01',
                endDate: '2025-06-30',
                progress: 10,
                status: 'pending',
                statusText: 'å¾…çºŒ',
                year: '2024'
            },
            // 2023å¹´å°ˆæ¡ˆ
            {
                id: 'PRJ-2023-010',
                name: 'æ¾å±±å€ä½å®…è¨­è¨ˆ',
                customer: 'æ—è‘£äº‹é•·',
                designer: 'designer01',
                designerName: 'ç‹ç¾çªˆ',
                startDate: '2023-03-01',
                endDate: '2023-08-30',
                progress: 100,
                status: 'completed',
                statusText: 'å·²å®Œæˆ',
                year: '2023'
            },
            {
                id: 'PRJ-2023-011',
                name: 'ä¿¡ç¾©å€å•†å ´è¨­è¨ˆ',
                customer: 'å•†å ´æ¥­ä¸»',
                designer: 'designer02',
                designerName: 'æå¿—è±ª',
                startDate: '2023-05-15',
                endDate: '2023-12-20',
                progress: 100,
                status: 'completed',
                statusText: 'å·²å®Œæˆ',
                year: '2023'
            },
            {
                id: 'PRJ-2023-012',
                name: 'å¤§ç›´è±ªå®…è¨­è¨ˆ',
                customer: 'è±ªå®…æ¥­ä¸»',
                designer: 'designer03',
                designerName: 'å¼µé›…å©·',
                startDate: '2023-01-10',
                endDate: '2023-06-30',
                progress: 85,
                status: 'pending',
                statusText: 'å¾…çºŒ',
                year: '2023'
            },
            // 2022å¹´å°ˆæ¡ˆ
            {
                id: 'PRJ-2022-008',
                name: 'ä¸­æ­£å€è¾¦å…¬å®¤',
                customer: 'ç§‘æŠ€å…¬å¸',
                designer: 'designer01',
                designerName: 'ç‹ç¾çªˆ',
                startDate: '2022-06-01',
                endDate: '2022-11-30',
                progress: 100,
                status: 'completed',
                statusText: 'å·²å®Œæˆ',
                year: '2022'
            },
            {
                id: 'PRJ-2022-009',
                name: 'è¬è¯å€è€å±‹ç¿»æ–°',
                customer: 'è€å±‹æ¥­ä¸»',
                designer: 'designer02',
                designerName: 'æå¿—è±ª',
                startDate: '2022-08-15',
                endDate: '2023-02-28',
                progress: 100,
                status: 'completed',
                statusText: 'å·²å®Œæˆ',
                year: '2022'
            },
            // 2021å¹´å°ˆæ¡ˆ
            {
                id: 'PRJ-2021-005',
                name: 'å£«æ—å€ä½å®…è¨­è¨ˆ',
                customer: 'ä½å®…æ¥­ä¸»',
                designer: 'designer01',
                designerName: 'ç‹ç¾çªˆ',
                startDate: '2021-09-01',
                endDate: '2022-03-30',
                progress: 100,
                status: 'completed',
                statusText: 'å·²å®Œæˆ',
                year: '2021'
            },
            {
                id: 'PRJ-2021-006',
                name: 'åŒ—æŠ•å€æº«æ³‰æœƒé¤¨',
                customer: 'æº«æ³‰æ¥­è€…',
                designer: 'designer03',
                designerName: 'å¼µé›…å©·',
                startDate: '2021-11-15',
                endDate: '2022-06-30',
                progress: 100,
                status: 'completed',
                statusText: 'å·²å®Œæˆ',
                year: '2021'
            }
        ];
        
        // å¯©æ ¸è³‡æ–™
        const approvalData = [
            {
                id: 'APP-001',
                type: 'é€²åº¦æ›´æ–°',
                projectId: 'PRJ-2025-001',
                projectName: 'å°ä¸­å»ºè¨­è¾¦å…¬å®¤è£ä¿®',
                applicant: 'ç‹ç¾çªˆ',
                applicantRole: 'è¨­è¨ˆå¸«',
                time: '2025-03-15 14:30',
                amount: null,
                status: 'review',
                statusText: 'å¾…å¯©æ ¸',
                description: 'æ°´é›»å·¥ç¨‹é€²åº¦æ›´æ–°è‡³95%'
            },
            {
                id: 'APP-002',
                type: 'è«‹æ¬¾ç”³è«‹',
                projectId: 'PRJ-2025-002',
                projectName: 'å…§æ¹–ä½å®…ç¿»æ–°è¨­è¨ˆ',
                applicant: 'æå¿—è±ª',
                applicantRole: 'è¨­è¨ˆå¸«',
                time: '2025-03-15 10:15',
                amount: 'NT$ 350,000',
                status: 'review',
                statusText: 'å¾…å¯©æ ¸',
                description: 'ç¬¬äºŒæœŸå·¥ç¨‹æ¬¾ç”³è«‹'
            },
            {
                id: 'APP-003',
                type: 'è¨­è¨ˆè®Šæ›´',
                projectId: 'PRJ-2025-001',
                projectName: 'å°ä¸­å»ºè¨­è¾¦å…¬å®¤è£ä¿®',
                applicant: 'ç‹ç¾çªˆ',
                applicantRole: 'è¨­è¨ˆå¸«',
                time: '2025-03-14 16:45',
                amount: 'NT$ 50,000',
                status: 'review',
                statusText: 'å¾…å¯©æ ¸',
                description: 'å¢åŠ æœƒè­°å®¤éš”éŸ³è¨­æ–½'
            },
            {
                id: 'APP-004',
                type: 'ææ–™æ¡è³¼',
                projectId: 'PRJ-2025-003',
                projectName: 'å¤§å®‰ä½å®…è£ä¿®',
                applicant: 'å¼µé›…å©·',
                applicantRole: 'è¨­è¨ˆå¸«',
                time: '2025-03-14 11:20',
                amount: 'NT$ 120,000',
                status: 'review',
                statusText: 'å¾…å¯©æ ¸',
                description: 'é€²å£ç£ç£šåŠè¡›æµ´è¨­å‚™æ¡è³¼'
            },
            {
                id: 'APP-005',
                type: 'å·¥æ™‚èª¿æ•´',
                projectId: 'PRJ-2025-004',
                projectName: 'ä¿¡ç¾©å•†è¾¦è¨­è¨ˆ',
                applicant: 'é»ƒå°èŠ³',
                applicantRole: 'è¨­è¨ˆåŠ©ç†',
                time: '2025-03-13 15:30',
                amount: null,
                status: 'review',
                statusText: 'å¾…å¯©æ ¸',
                description: 'æœ¬æœˆåŠ ç­å·¥æ™‚ç”³è«‹'
            }
        ];
        
        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('å°ˆæ¡ˆç®¡ç†ç³»çµ±è¼‰å…¥ä¸­...');
            initializeUser();
            initializePage();
        });
        
        function initializeUser() {
            const userInfo = localStorage.getItem('userInfo');
            
            if (userInfo) {
                try {
                    currentUser = JSON.parse(userInfo);
                    document.getElementById('navUserInfo').textContent = `${currentUser.fullName} (${currentUser.role})`;
                } catch (e) {
                    setDefaultUser();
                }
            } else {
                setDefaultUser();
            }
            
            setUserPermissions();
        }
        
        function setDefaultUser() {
            currentUser = {
                fullName: 'ä½ä½æœ¨è³¢',
                role: 'ç®¡ç†è€…',
                department: 'ç®¡ç†éƒ¨'
            };
            document.getElementById('navUserInfo').textContent = `${currentUser.fullName} (${currentUser.role})`;
        }
        
        function setUserPermissions() {
            const role = currentUser.role;
            
            userPermissions = {
                canViewAllProjects: ['ç®¡ç†è€…', 'è€é—†'].includes(role),
                canEditProjects: ['ç®¡ç†è€…'].includes(role),
                canApprove: ['ç®¡ç†è€…', 'è€é—†', 'æœƒè¨ˆä¸»ç®¡'].includes(role),
                isDesigner: role.includes('è¨­è¨ˆ'),
                isBoss: role === 'è€é—†'
            };
        }
        
        function initializePage() {
            console.log('åˆå§‹åŒ–é é¢...');
            console.log('ç•¶å‰ç”¨æˆ¶ï¼š', currentUser);
            console.log('ç”¨æˆ¶æ¬Šé™ï¼š', userPermissions);
            
            generateYearGroups();
            loadDashboardData();
            loadApprovalData();
            updateProjectCounts();
            
            // è‡ªå‹•å±•é–‹ç•¶å‰å¹´ä»½
            setTimeout(() => {
                const currentYear = new Date().getFullYear();
                toggleYear(currentYear.toString());
            }, 500);
        }
        
        // å‹•æ…‹ç”Ÿæˆå¹´ä»½çµ„
        function generateYearGroups() {
            const container = document.getElementById('yearGroupsContainer');
            let yearGroupsHTML = '';
            
            for (let year = YEAR_RANGE.end; year >= YEAR_RANGE.start; year--) {
                const yearProjects = projectsData.filter(p => p.year === year.toString());
                const activeCount = yearProjects.filter(p => p.status === 'active').length;
                const completedCount = yearProjects.filter(p => p.status === 'completed').length;
                const pendingCount = yearProjects.filter(p => p.status === 'pending').length;
                const totalCount = yearProjects.length;
                
                yearGroupsHTML += `
                    <div class="year-group">
                        <div class="year-header" onclick="toggleYear('${year}')">
                            <span class="year-toggle" id="toggle-${year}">â–¶</span>
                            <span>${year}å¹´</span>
                            <span class="menu-badge info">${totalCount}</span>
                        </div>
                        <div class="year-content" id="year-${year}">
                            <div class="status-group">
                                <div class="status-item" onclick="showProjectsByStatus('${year}', 'active')">
                                    <div class="status-icon active"></div>
                                    <span>é€²è¡Œä¸­</span>
                                    <span class="menu-badge success">${activeCount}</span>
                                </div>
                                <div class="status-item" onclick="showProjectsByStatus('${year}', 'completed')">
                                    <div class="status-icon completed"></div>
                                    <span>å·²å®Œæˆ</span>
                                    <span class="menu-badge info">${completedCount}</span>
                                </div>
                                <div class="status-item" onclick="showProjectsByStatus('${year}', 'pending')">
                                    <div class="status-icon pending"></div>
                                    <span>å¾…çºŒ</span>
                                    <span class="menu-badge warning">${pendingCount}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = yearGroupsHTML;
        }
        
        function loadDashboardData() {
            loadStatistics();
            loadRecentProjects();
            loadMyProjects();
        }
        
        function loadStatistics() {
            const statsGrid = document.getElementById('statsGrid');
            let stats = [];
            
            if (userPermissions.canViewAllProjects) {
                const activeProjects = projectsData.filter(p => p.status === 'active').length;
                const completedProjects = projectsData.filter(p => p.status === 'completed').length;
                const pendingProjects = projectsData.filter(p => p.status === 'pending').length;
                const avgProgress = Math.round(projectsData.reduce((sum, p) => sum + p.progress, 0) / projectsData.length);
                
                stats = [
                    { icon: 'ğŸ“‹', iconClass: 'blue', value: activeProjects.toString(), label: 'åŸ·è¡Œä¸­å°ˆæ¡ˆ', change: '+2 æœ¬æœˆæ–°å¢', changeClass: 'positive' },
                    { icon: 'âš¡', iconClass: 'green', value: `${avgProgress}%`, label: 'å¹³å‡é€²åº¦', change: '+5% è¼ƒä¸Šæœˆ', changeClass: 'positive' },
                    { icon: 'â°', iconClass: 'yellow', value: pendingProjects.toString(), label: 'å»¶æœŸå°ˆæ¡ˆ', change: 'éœ€è¦é—œæ³¨', changeClass: 'negative' },
                    { icon: 'âœ…', iconClass: 'purple', value: completedProjects.toString(), label: 'å·²å®Œæˆå°ˆæ¡ˆ', change: 'æ­·å¹´ç´¯è¨ˆ', changeClass: 'positive' }
                ];
            } else if (userPermissions.isDesigner) {
                const myProjects = getMyProjects();
                const myAvgProgress = myProjects.length > 0 ? Math.round(myProjects.reduce((sum, p) => sum + p.progress, 0) / myProjects.length) : 0;
                
                stats = [
                    { icon: 'ğŸ“‹', iconClass: 'blue', value: myProjects.length.toString(), label: 'æˆ‘çš„å°ˆæ¡ˆ', change: 'ç•¶å‰è² è²¬', changeClass: 'positive' },
                    { icon: 'âš¡', iconClass: 'green', value: `${myAvgProgress}%`, label: 'å¹³å‡é€²åº¦', change: 'è¡¨ç¾è‰¯å¥½', changeClass: 'positive' },
                    { icon: 'ğŸ“ˆ', iconClass: 'purple', value: '85%', label: 'è€ƒæ ¸åˆ†æ•¸', change: 'æœ¬æœˆè¡¨ç¾', changeClass: 'positive' },
                    { icon: 'ğŸ“', iconClass: 'yellow', value: '2', label: 'å¾…å¡«å¯«é …ç›®', change: 'è«‹åŠæ™‚æ›´æ–°', changeClass: 'warning' }
                ];
            }
            
            statsGrid.innerHTML = stats.map(stat => `
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon ${stat.iconClass}">${stat.icon}</div>
                    </div>
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                    <div class="stat-change ${stat.changeClass}">${stat.change}</div>
                </div>
            `).join('');
        }
        
        function loadRecentProjects() {
            const recentProjectsList = document.getElementById('recentProjectsList');
            const recentProjects = projectsData.filter(p => p.status === 'active').slice(0, 5);
            
            recentProjectsList.innerHTML = recentProjects.map(project => `
                <tr>
                    <td>${project.id}</td>
                    <td>${project.name}</td>
                    <td>${project.customer}</td>
                    <td>${project.startDate}</td>
                    <td>${project.endDate}</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${project.progress}%;"></div>
                        </div>
                        <div class="progress-text">${project.progress}%</div>
                    </td>
                    <td><span class="status-badge status-${project.status}">${project.statusText}</span></td>
                    <td>
                        <button class="btn" onclick="viewProjectDetail('${project.id}')">æª¢è¦–</button>
                    </td>
                </tr>
            `).join('');
        }
        
        function loadMyProjects() {
            const myProjects = getMyProjects();
            document.getElementById('myProjectsBadge').textContent = myProjects.length;
            
            const projectsList = document.getElementById('myProjectsList');
            if (projectsList) {
                projectsList.innerHTML = myProjects.map(project => `
                    <tr>
                        <td>${project.id}</td>
                        <td>${project.name}</td>
                        <td>${project.customer}</td>
                        <td>${project.startDate}</td>
                        <td>${project.endDate}</td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${project.progress}%;"></div>
                            </div>
                            <div class="progress-text">${project.progress}%</div>
                        </td>
                        <td><span class="status-badge status-${project.status}">${project.statusText}</span></td>
                        <td>
                            <button class="btn" onclick="viewProjectDetail('${project.id}')">æª¢è¦–</button>
                            ${userPermissions.isDesigner ? '<button class="btn btn-primary" onclick="updateProgress(\'' + project.id + '\')">æ›´æ–°é€²åº¦</button>' : ''}
                        </td>
                    </tr>
                `).join('');
            }
        }
        
        function loadApprovalData() {
            const approvalList = document.getElementById('approvalList');
            document.getElementById('approvalBadge').textContent = approvalData.length;
            
            if (approvalList) {
                approvalList.innerHTML = approvalData.map(item => `
                    <tr>
                        <td>${item.type}</td>
                        <td>${item.projectName}</td>
                        <td>${item.applicant} (${item.applicantRole})</td>
                        <td>${item.time}</td>
                        <td>${item.amount || '-'}</td>
                        <td><span class="status-badge status-${item.status}">${item.statusText}</span></td>
                        <td>
                            <button class="btn btn-success btn-sm" onclick="approveItem('${item.id}')">åŒæ„</button>
                            <button class="btn btn-warning btn-sm" onclick="rejectItem('${item.id}')">é€€å›</button>
                            <button class="btn btn-danger btn-sm" onclick="denyItem('${item.id}')">æ‹’çµ•</button>
                        </td>
                    </tr>
                `).join('');
            }
        }
        
        function getMyProjects() {
            const username = localStorage.getItem('user') || 'designer01';
            
            if (userPermissions.canViewAllProjects) {
                return projectsData;
            } else if (userPermissions.isDesigner) {
                return projectsData.filter(project => project.designer === username);
            } else {
                return [];
            }
        }
        
        function updateProjectCounts() {
            document.getElementById('allProjectsBadge').textContent = projectsData.length;
        }
        
        // å¹´ä»½æ‘ºç–ŠåŠŸèƒ½
        function toggleYear(year) {
            const toggle = document.getElementById(`toggle-${year}`);
            const content = document.getElementById(`year-${year}`);
            
            if (content && toggle) {
                if (content.classList.contains('expanded')) {
                    content.classList.remove('expanded');
                    toggle.classList.remove('expanded');
                    toggle.textContent = 'â–¶';
                } else {
                    content.classList.add('expanded');
                    toggle.classList.add('expanded');
                    toggle.textContent = 'â–¼';
                }
            }
        }
        
        // é¡¯ç¤ºç‰¹å®šå¹´ä»½å’Œç‹€æ…‹çš„å°ˆæ¡ˆ
        function showProjectsByStatus(year, status) {
            console.log(`é¡¯ç¤º ${year} å¹´ ${status} ç‹€æ…‹çš„å°ˆæ¡ˆ`);
            
            // æ¸…é™¤æ‰€æœ‰activeç‹€æ…‹
            document.querySelectorAll('.menu-item, .status-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // è¨­ç½®ç•¶å‰é¸ä¸­çš„ç‹€æ…‹é …ç›®ç‚ºactive
            event.target.closest('.status-item').classList.add('active');
            
            // ç¯©é¸å°ˆæ¡ˆ
            let filteredProjects = projectsData.filter(project => {
                return project.year === year && project.status === status;
            });
            
            // å¦‚æœä¸æ˜¯ç®¡ç†è€…ï¼Œåªé¡¯ç¤ºè‡ªå·±çš„å°ˆæ¡ˆ
            if (!userPermissions.canViewAllProjects && userPermissions.isDesigner) {
                const username = localStorage.getItem('user') || 'designer01';
                filteredProjects = filteredProjects.filter(project => project.designer === username);
            }
            
            // éš±è—æ‰€æœ‰å…§å®¹
            hideAllContent();
            
            // é¡¯ç¤ºå¹´ä»½ç‹€æ…‹å°ˆæ¡ˆåˆ—è¡¨
            document.getElementById('yearStatusContent').classList.add('active');
            
            // æ›´æ–°æ¨™é¡Œ
            const statusMap = {
                'active': 'é€²è¡Œä¸­',
                'completed': 'å·²å®Œæˆ',
                'pending': 'å¾…çºŒ'
            };
            
            document.getElementById('yearStatusTitle').textContent = `${year}å¹´ ${statusMap[status]} å°ˆæ¡ˆ`;
            document.getElementById('yearStatusSubtitle').textContent = `å…± ${filteredProjects.length} å€‹å°ˆæ¡ˆ`;
            document.getElementById('yearStatusTableTitle').textContent = `${year}å¹´ ${statusMap[status]} å°ˆæ¡ˆåˆ—è¡¨`;
            
            // è¼‰å…¥å°ˆæ¡ˆåˆ—è¡¨
            const yearStatusProjectsList = document.getElementById('yearStatusProjectsList');
            yearStatusProjectsList.innerHTML = filteredProjects.map(project => `
                <tr>
                    <td>${project.id}</td>
                    <td>${project.name}</td>
                    <td>${project.customer}</td>
                    <td>${project.startDate}</td>
                    <td>${project.endDate}</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${project.progress}%;"></div>
                        </div>
                        <div class="progress-text">${project.progress}%</div>
                    </td>
                    <td><span class="status-badge status-${project.status}">${project.statusText}</span></td>
                    <td>
                        <button class="btn" onclick="viewProjectDetail('${project.id}')">æª¢è¦–</button>
                        ${userPermissions.isDesigner && project.designer === (localStorage.getItem('user') || 'designer01') ? '<button class="btn btn-primary" onclick="updateProgress(\'' + project.id + '\')">æ›´æ–°é€²åº¦</button>' : ''}
                    </td>
                </tr>
            `).join('');
        }
        
        // æŸ¥çœ‹å°ˆæ¡ˆè©³æƒ…
        function viewProjectDetail(projectId) {
            console.log('æŸ¥çœ‹å°ˆæ¡ˆè©³æƒ…:', projectId);
            currentProjectId = projectId;
            const project = projectsData.find(p => p.id === projectId);
            
            if (!project) {
                alert('æ‰¾ä¸åˆ°å°ˆæ¡ˆè³‡æ–™');
                return;
            }
            
            // æ¸…é™¤æ‰€æœ‰activeç‹€æ…‹
            document.querySelectorAll('.menu-item, .status-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // éš±è—æ‰€æœ‰å…§å®¹
            hideAllContent();
            
            // é¡¯ç¤ºå°ˆæ¡ˆè©³æƒ…
            document.getElementById('projectDetailContent').classList.add('active');
            
            // è¼‰å…¥å°ˆæ¡ˆè©³æƒ…è³‡æ–™
            loadProjectDetailData(project);
        }
        
        function loadProjectDetailData(project) {
            // æ›´æ–°å°ˆæ¡ˆæ¨™é¡Œè³‡è¨Š
            document.getElementById('detailProjectTitle').textContent = project.name;
            document.getElementById('detailProjectCode').textContent = `å°ˆæ¡ˆç·¨è™Ÿï¼š${project.id}`;
            document.getElementById('detailProjectStatus').textContent = project.statusText;
            
            // æ›´æ–°é€²åº¦æ¢
            const progressFill = document.getElementById('detailProgressFill');
            const progressText = document.getElementById('detailProgressText');
            progressFill.style.width = `${project.progress}%`;
            progressText.textContent = `${project.progress}% å®Œæˆ (æŒ‰é€²åº¦åŸ·è¡Œä¸­)`;
            
            // æ›´æ–°åŸºæœ¬è³‡è¨Šç¶²æ ¼
            const infoGrid = document.getElementById('detailInfoGrid');
            infoGrid.innerHTML = `
                <div class="info-card">
                    <div class="info-label">å®¢æˆ¶åç¨±</div>
                    <div class="info-value">${project.customer}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">è² è²¬è¨­è¨ˆå¸«</div>
                    <div class="info-value">${project.designerName}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">å°ˆæ¡ˆé¡åˆ¥</div>
                    <div class="info-value">å•†æ¥­ç©ºé–“ / è¾¦å…¬å®¤</div>
                </div>
                <div class="info-card">
                    <div class="info-label">é–‹å§‹æ—¥æœŸ</div>
                    <div class="info-value">${project.startDate}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">é è¨ˆå®Œå·¥</div>
                    <div class="info-value">${project.endDate}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">åˆç´„é‡‘é¡</div>
                    <div class="info-value amount">NT$ 3,500,000</div>
                </div>
            `;
        }
        
        // éš±è—æ‰€æœ‰å…§å®¹é é¢
        function hideAllContent() {
            document.querySelectorAll('.content-page').forEach(page => {
                page.classList.remove('active');
            });
        }
        
        // é é¢åˆ‡æ›åŠŸèƒ½
        function showPage(page) {
            console.log('åˆ‡æ›åˆ°é é¢:', page);
            
            // ç§»é™¤æ‰€æœ‰activeç‹€æ…‹
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // è¨­ç½®ç•¶å‰é é¢ç‚ºactive
            if (event && event.target) {
                event.target.closest('.menu-item').classList.add('active');
            }
            
            // éš±è—æ‰€æœ‰å…§å®¹
            hideAllContent();
            
            // é¡¯ç¤ºå°æ‡‰å…§å®¹
            if (page === 'dashboard') {
                document.getElementById('dashboardContent').classList.add('active');
                loadDashboardData();
            } else if (page === 'projects') {
                document.getElementById('projectsContent').classList.add('active');
                loadMyProjects();
            } else if (page === 'approval') {
                document.getElementById('approvalContent').classList.add('active');
                loadApprovalData();
            } else {
                // å…¶ä»–é é¢é¡¯ç¤ºé–‹ç™¼ä¸­è¨Šæ¯
                const pageMap = {
                    'allProjects': 'æ‰€æœ‰å°ˆæ¡ˆ',
                    'assignment': 'å°ˆæ¡ˆåˆ†æ´¾'
                };
                
                alert(`åˆ‡æ›åˆ°ï¼š${pageMap[page]}\n\nå­ç³»çµ±åŠŸèƒ½é–‹ç™¼ä¸­...`);
                
                // æ¢å¾©å„€è¡¨æ¿é¡¯ç¤º
                document.getElementById('dashboardContent').classList.add('active');
                document.querySelector('.menu-item').classList.add('active');
            }
        }
        
        // æ¨™ç±¤é åˆ‡æ›åŠŸèƒ½
        function switchTab(event, tabName) {
            // ç§»é™¤æ‰€æœ‰æ¨™ç±¤é çš„activeç‹€æ…‹
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // è¨­ç½®ç•¶å‰æ¨™ç±¤é ç‚ºactive
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        // å¯©æ ¸åŠŸèƒ½
        function approveItem(id) {
            if (confirm('ç¢ºå®šè¦åŒæ„é€™å€‹ç”³è«‹å—ï¼Ÿ')) {
                const item = approvalData.find(item => item.id === id);
                if (item) {
                    alert(`å·²åŒæ„ç”³è«‹ ${id}\nç”³è«‹é¡å‹ï¼š${item.type}\nç”³è«‹äººï¼š${item.applicant}\n\nç”³è«‹å°‡é€²å…¥ä¸‹ä¸€å€‹å¯©æ ¸éšæ®µæˆ–å®Œæˆè™•ç†`);
                    loadApprovalData();
                }
            }
        }
        
        function rejectItem(id) {
            const reason = prompt('è«‹è¼¸å…¥é€€å›åŸå› ï¼š');
            if (reason) {
                const item = approvalData.find(item => item.id === id);
                if (item) {
                    alert(`å·²é€€å›ç”³è«‹ ${id}\né€€å›åŸå› ï¼š${reason}\n\nç”³è«‹å·²é€€å›çµ¦ç”³è«‹äººä¿®æ”¹`);
                    loadApprovalData();
                }
            }
        }
        
        function denyItem(id) {
            const reason = prompt('è«‹è¼¸å…¥æ‹’çµ•åŸå› ï¼š');
            if (reason) {
                const item = approvalData.find(item => item.id === id);
                if (item) {
                    alert(`å·²æ‹’çµ•ç”³è«‹ ${id}\næ‹’çµ•åŸå› ï¼š${reason}\n\nç”³è«‹å·²è¢«æ­£å¼æ‹’çµ•`);
                    loadApprovalData();
                }
            }
        }
        
        // å¿«é€Ÿæ“ä½œåŠŸèƒ½
        function quickAction(action) {
            if (userPermissions.isBoss) {
                alert('æ‚¨ç•¶å‰ç‚ºæŸ¥çœ‹æ¨¡å¼ï¼Œç„¡æ³•é€²è¡Œæ­¤æ“ä½œ');
                return;
            }
            
            const actionMap = {
                'newProject': 'æ–°å¢å°ˆæ¡ˆ'
            };
            
            alert(`åŸ·è¡Œï¼š${actionMap[action]}\n\nåŠŸèƒ½é–‹ç™¼ä¸­...`);
        }
        
        function updateProgress(projectId) {
            alert(`æ›´æ–°å°ˆæ¡ˆé€²åº¦ï¼š${projectId}\n\nå°‡é–‹å•Ÿé€²åº¦æ›´æ–°è¡¨å–®...`);
        }
        
        // å°èˆªåŠŸèƒ½
        function goBack() {
            if (confirm('ç¢ºå®šè¦è¿”å›ä¸»æ§åˆ¶å°å—ï¼Ÿ')) {
                try {
                    window.location.href = 'dashboard.html';
                } catch (e) {
                    alert('è¿”å›ä¸»æ§åˆ¶å°\n\nè«‹ç¢ºä¿dashboard.htmlæª”æ¡ˆå­˜åœ¨');
                }
            }
        }
        
        function goHome() {
            if (confirm('ç¢ºå®šè¦è¿”å›ä¸»æ§åˆ¶å°å—ï¼Ÿ')) {
                try {
                    window.location.href = 'dashboard.html';
                } catch (e) {
                    alert('è¿”å›ä¸»æ§åˆ¶å°\n\nè«‹ç¢ºä¿dashboard.htmlæª”æ¡ˆå­˜åœ¨');
                }
            }
        }
        
        function logout() {
            if (confirm('ç¢ºå®šè¦ç™»å‡ºç³»çµ±å—ï¼Ÿ')) {
                localStorage.removeItem('user');
                localStorage.removeItem('userInfo');
                try {
                    window.location.href = 'index.html';
                } catch (e) {
                    alert('å·²ç™»å‡ºç³»çµ±\n\nè«‹æ‰‹å‹•å°èˆªè‡³ç™»å…¥é é¢');
                }
            }
        }
        
        // å‹•æ…‹å¹´ä»½æ“´å±•åŠŸèƒ½ (ä¾›æœªä¾†ä½¿ç”¨)
        function addNewYear(year) {
            // æ›´æ–°å¹´ä»½ç¯„åœ
            if (year > YEAR_RANGE.end) {
                YEAR_RANGE.end = year;
            } else if (year < YEAR_RANGE.start) {
                YEAR_RANGE.start = year;
            }
            
            // é‡æ–°ç”Ÿæˆå¹´ä»½çµ„
            generateYearGroups();
            updateProjectCounts();
            
            console.log(`å·²æ·»åŠ  ${year} å¹´åˆ°ç³»çµ±ä¸­`);
        }
    </script>
</body>
</html>
