<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>專案管理系統 - 佐佐木賢室內裝修設計會計系統</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft JhengHei', 'PingFang TC', Arial, sans-serif;
        }
        
        body {
            background: #f8fafc;
            min-height: 100vh;
            line-height: 1.6;
        }
        
        /* 導航列 */
        .navbar {
            background: white;
            padding: 12px 30px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #e2e8f0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .nav-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #3b82f6, #06b6d4);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }
        
        .nav-title {
            font-size: 18px;
            color: #1e293b;
            font-weight: 600;
        }
        
        .nav-right {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        
        .btn {
            padding: 8px 16px;
            border: 1px solid #d1d5db;
            background: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            color: #374151;
            transition: all 0.2s;
            text-decoration: none;
        }
        
        .btn:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
            border: none;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .user-info {
            background: #f9fafb;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            color: #374151;
        }
        
        /* 主容器 */
        .container {
            display: flex;
            min-height: calc(100vh - 65px);
        }
        
        /* 側邊欄 */
        .sidebar {
            width: 320px;
            background: white;
            border-right: 1px solid #e2e8f0;
            padding: 20px 0;
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 20px;
        }
        
        .sidebar-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }
        
        .sidebar-subtitle {
            font-size: 14px;
            color: #64748b;
            margin-top: 4px;
        }
        
        .menu-section {
            margin-bottom: 20px;
        }
        
        .menu-section-title {
            padding: 0 20px 8px;
            font-size: 12px;
            font-weight: 600;
            color: #94a3b8;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .menu-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #475569;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            position: relative;
        }
        
        .menu-item:hover {
            background: #f8fafc;
            color: #1e293b;
        }
        
        .menu-item.active {
            background: #eff6ff;
            color: #2563eb;
            border-left-color: #2563eb;
        }
        
        .menu-icon {
            font-size: 18px;
            width: 20px;
            text-align: center;
        }
        
        .menu-text {
            font-size: 14px;
            font-weight: 500;
            flex: 1;
        }
        
        .menu-badge {
            background: #dc2626;
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 18px;
            text-align: center;
            margin-left: auto;
        }
        
        .menu-badge.info {
            background: #3b82f6;
        }
        
        .menu-badge.success {
            background: #10b981;
        }
        
        .menu-badge.warning {
            background: #f59e0b;
        }
        
        /* 年份摺疊選單 */
        .year-group {
            margin-bottom: 10px;
        }
        
        .year-header {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            background: #f8fafc;
            border-top: 1px solid #e2e8f0;
            border-bottom: 1px solid #e2e8f0;
            cursor: pointer;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }
        
        .year-header:hover {
            background: #f1f5f9;
        }
        
        .year-toggle {
            font-size: 12px;
            transition: transform 0.2s;
        }
        
        .year-toggle.expanded {
            transform: rotate(90deg);
        }
        
        .year-content {
            display: none;
            background: #fafbfc;
        }
        
        .year-content.expanded {
            display: block;
        }
        
        .status-group {
            padding-left: 10px;
        }
        
        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            color: #64748b;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 13px;
        }
        
        .status-item:hover {
            background: #f1f5f9;
            color: #374151;
        }
        
        .status-item.active {
            background: #dbeafe;
            color: #2563eb;
            font-weight: 500;
        }
        
        .status-icon {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        
        .status-icon.active { background: #10b981; }
        .status-icon.completed { background: #3b82f6; }
        .status-icon.pending { background: #f59e0b; }
        
        /* 主內容區 */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            min-width: 0;
        }
        
        /* 頁面標題 */
        .page-header {
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .page-subtitle {
            font-size: 14px;
            color: #64748b;
        }
        
        .page-actions {
            display: flex;
            gap: 10px;
        }
        
        /* 統計卡片 */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .stat-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 16px;
        }
        
        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .stat-icon.blue { background: #dbeafe; color: #2563eb; }
        .stat-icon.green { background: #d1fae5; color: #059669; }
        .stat-icon.yellow { background: #fef3c7; color: #d97706; }
        .stat-icon.purple { background: #ede9fe; color: #7c3aed; }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 4px;
        }
        
        .stat-label {
            font-size: 14px;
            color: #64748b;
            margin-bottom: 8px;
        }
        
        .stat-change {
            font-size: 12px;
            font-weight: 500;
        }
        
        .stat-change.positive { color: #059669; }
        .stat-change.negative { color: #dc2626; }
        .stat-change.warning { color: #d97706; }
        
        /* 統計卡片專案列表 */
        .stat-projects {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }
        
        .stat-project-item {
            font-size: 12px;
            color: #475569;
            padding: 4px 8px;
            margin: 2px 0;
            background: #f8fafc;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid #3b82f6;
        }
        
        .stat-project-item:hover {
            background: #e2e8f0;
            color: #1e293b;
            transform: translateX(2px);
        }
        
        .stat-project-more {
            font-size: 11px;
            color: #94a3b8;
            text-align: center;
            padding: 4px;
            font-style: italic;
        }
        
        /* 專案表格 */
        .project-table {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            overflow: hidden;
            margin-bottom: 30px;
        }
        
        .table-header {
            padding: 20px 24px;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .table-title {
            font-size: 16px;
            font-weight: 600;
            color: #1e293b;
        }
        
        .table-content {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #f1f5f9;
            white-space: nowrap;
        }
        
        th {
            background: #f8fafc;
            font-size: 13px;
            font-weight: 600;
            color: #475569;
        }
        
        td {
            font-size: 14px;
            color: #1e293b;
        }
        
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .status-active { background: #dcfce7; color: #166534; }
        .status-pending { background: #fef3c7; color: #92400e; }
        .status-completed { background: #dbeafe; color: #1e40af; }
        .status-review { background: #e0e7ff; color: #4338ca; }
        .status-approved { background: #dcfce7; color: #166534; }
        .status-rejected { background: #fee2e2; color: #991b1b; }
        
        .progress-bar {
            width: 80px;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 4px;
        }
        
        .progress-fill {
            height: 100%;
            background: #10b981;
            transition: width 0.3s ease;
        }
        
        .progress-text {
            font-size: 11px;
            color: #64748b;
        }
        
        /* 專案詳情樣式 */
        .project-detail-container {
            display: none;
        }
        
        .project-detail-container.active {
            display: block;
        }
        
        .project-header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }
        
        .project-title-row {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 24px;
        }
        
        .project-title {
            font-size: 28px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 8px;
        }
        
        .project-code {
            color: #64748b;
            font-size: 16px;
        }
        
        .project-status {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .status-badge-large {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }
        
        /* 資訊網格 */
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-bottom: 20px;
        }
        
        .info-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .info-label {
            color: #64748b;
            font-size: 14px;
            margin-bottom: 6px;
            font-weight: 500;
        }
        
        .info-value {
            color: #1e293b;
            font-size: 16px;
            font-weight: 600;
        }
        
        .info-value.amount {
            color: #0891b2;
            font-size: 18px;
        }
        
        /* 進度條 */
        .progress-section {
            margin-top: 20px;
        }
        
        .progress-bar-large {
            width: 100%;
            height: 12px;
            background: #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
            margin-top: 8px;
        }
        
        .progress-fill-large {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s ease;
        }
        
        .progress-text {
            text-align: center;
            margin-top: 8px;
            font-size: 14px;
            color: #475569;
        }
        
        /* 標籤頁 */
        .tabs-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            overflow: hidden;
        }
        
        .tabs-nav {
            display: flex;
            background: #f8fafc;
            border-bottom: 1px solid #e2e8f0;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 16px 20px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
            white-space: nowrap;
            position: relative;
            min-width: fit-content;
        }
        
        .tab-btn:hover {
            background: #f1f5f9;
            color: #475569;
        }
        
        .tab-btn.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: white;
        }
        
        .tab-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #dc2626;
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 10px;
            min-width: 16px;
            text-align: center;
        }
        
        .tab-content {
            padding: 30px;
            min-height: 400px;
        }
        
        .tab-panel {
            display: none;
        }
        
        .tab-panel.active {
            display: block;
        }
        
        .tab-panel h3 {
            color: #1e293b;
            font-size: 18px;
            margin-bottom: 16px;
            padding-bottom: 8px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .tab-panel p {
            color: #64748b;
            line-height: 1.6;
        }
        
        /* 內容顯示控制 */
        .content-page {
            display: none;
        }
        
        .content-page.active {
            display: block;
        }
        
        /* 審核相關樣式 */
        .approval-item {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
        }
        
        .approval-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .approval-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .approval-info {
            flex: 1;
        }
        
        .approval-title {
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 4px;
        }
        
        .approval-details {
            font-size: 13px;
            color: #64748b;
        }
        
        .approval-actions {
            display: flex;
            gap: 8px;
        }
        
        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 4px;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
            border: none;
        }
        
        .btn-warning {
            background: #f59e0b;
            color: white;
            border: none;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
            border: none;
        }
        
        /* 響應式設計 */
        @media (max-width: 1024px) {
            .sidebar {
                width: 280px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 300px;
            }
            
            .main-content {
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .navbar {
                padding: 10px 15px;
            }
            
            .page-header {
                flex-direction: column;
                gap: 15px;
            }
            
            .project-title-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }
            
            .table-content {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px 12px;
            }
            
            .tabs-nav {
                flex-wrap: nowrap;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-left">
            <div class="logo">佐</div>
            <div class="nav-title">專案管理系統</div>
        </div>
        <div class="nav-right">
            <button class="btn" onclick="goBack()">返回主控制台</button>
            <button class="btn btn-primary" onclick="goHome()">主目錄</button>
            <span class="user-info" id="navUserInfo">管理者</span>
            <button class="btn" onclick="logout()">登出</button>
        </div>
    </nav>

    <div class="container">
        <!-- 側邊欄 -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">專案管理系統</div>
                <div class="sidebar-subtitle">佐佐木賢會計系統 v2.0</div>
            </div>
            
            <div class="menu-section">
                <div class="menu-section-title">總覽</div>
                <div class="menu-item active" onclick="showPage('dashboard')">
                    <div class="menu-icon">📊</div>
                    <div class="menu-text">儀表板</div>
                </div>
                <div class="menu-item" onclick="showPage('projects')">
                    <div class="menu-icon">📋</div>
                    <div class="menu-text">我的專案</div>
                    <div class="menu-badge" id="myProjectsBadge">0</div>
                </div>
            </div>
            
            <!-- 專案歷史檔案 -->
            <div class="menu-section">
                <div class="menu-section-title">專案歷史檔案</div>
                <div id="yearGroupsContainer">
                    <!-- 動態生成年份組 -->
                </div>
            </div>
            
            <div class="menu-section" id="adminSection">
                <div class="menu-section-title">管理功能</div>
                <div class="menu-item" onclick="showPage('allProjects')">
                    <div class="menu-icon">📂</div>
                    <div class="menu-text">所有專案</div>
                    <div class="menu-badge info" id="allProjectsBadge">0</div>
                </div>
                <div class="menu-item" onclick="showPage('approval')">
                    <div class="menu-icon">✅</div>
                    <div class="menu-text">審核中心</div>
                    <div class="menu-badge" id="approvalBadge">0</div>
                </div>
                <div class="menu-item" onclick="showPage('assignment')">
                    <div class="menu-icon">👥</div>
                    <div class="menu-text">專案分派</div>
                </div>
            </div>
        </div>
        
        <!-- 主內容區 -->
        <div class="main-content">
            <!-- 儀表板內容 -->
            <div id="dashboardContent" class="content-page active">
                <div class="page-header">
                    <div>
                        <div class="page-title">工程進度總覽</div>
                        <div class="page-subtitle">即時監控專案進度與個人績效數據</div>
                    </div>
                    <div class="page-actions" id="dashboardActions">
                        <button class="btn btn-primary" onclick="quickAction('newProject')">新增專案</button>
                    </div>
                </div>
                
                <!-- 統計卡片 -->
                <div class="stats-grid" id="statsGrid">
                    <!-- 動態生成統計卡片 -->
                </div>
                
                <!-- 專案列表 -->
                <div class="project-table">
                    <div class="table-header">
                        <div class="table-title">最近專案</div>
                    </div>
                    
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>專案編號</th>
                                    <th>專案名稱</th>
                                    <th>客戶</th>
                                    <th>開始日期</th>
                                    <th>預計完工</th>
                                    <th>進度</th>
                                    <th>狀態</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="recentProjectsList">
                                <!-- 動態生成專案列表 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- 我的專案內容 -->
            <div id="projectsContent" class="content-page">
                <div class="page-header">
                    <div>
                        <div class="page-title">我的專案</div>
                        <div class="page-subtitle">管理您負責的專案進度與工作內容</div>
                    </div>
                </div>
                
                <div class="project-table">
                    <div class="table-header">
                        <div class="table-title">專案列表</div>
                    </div>
                    
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>專案編號</th>
                                    <th>專案名稱</th>
                                    <th>客戶</th>
                                    <th>開始日期</th>
                                    <th>預計完工</th>
                                    <th>進度</th>
                                    <th>狀態</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="myProjectsList">
                                <!-- 動態生成專案列表 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- 年份狀態專案列表 -->
            <div id="yearStatusContent" class="content-page">
                <div class="page-header">
                    <div>
                        <div class="page-title" id="yearStatusTitle">專案列表</div>
                        <div class="page-subtitle" id="yearStatusSubtitle">依年份和狀態篩選的專案</div>
                    </div>
                    <div class="page-actions">
                        <button class="btn" onclick="showPage('dashboard')">返回總覽</button>
                    </div>
                </div>
                
                <div class="project-table">
                    <div class="table-header">
                        <div class="table-title" id="yearStatusTableTitle">專案列表</div>
                    </div>
                    
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>專案編號</th>
                                    <th>專案名稱</th>
                                    <th>客戶</th>
                                    <th>開始日期</th>
                                    <th>完工日期</th>
                                    <th>進度</th>
                                    <th>狀態</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="yearStatusProjectsList">
                                <!-- 動態生成年份狀態專案列表 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- 審核中心內容 -->
            <div id="approvalContent" class="content-page">
                <div class="page-header">
                    <div>
                        <div class="page-title">審核中心</div>
                        <div class="page-subtitle">處理專案相關的審核事項</div>
                    </div>
                    <div class="page-actions">
                        <button class="btn" onclick="showPage('dashboard')">返回總覽</button>
                    </div>
                </div>
                
                <div class="project-table">
                    <div class="table-header">
                        <div class="table-title">待審核項目</div>
                    </div>
                    
                    <div class="table-content">
                        <table>
                            <thead>
                                <tr>
                                    <th>申請類型</th>
                                    <th>專案名稱</th>
                                    <th>申請人</th>
                                    <th>申請時間</th>
                                    <th>金額</th>
                                    <th>狀態</th>
                                    <th>操作</th>
                                </tr>
                            </thead>
                            <tbody id="approvalList">
                                <!-- 動態生成審核列表 -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- 專案詳情內容 -->
            <div id="projectDetailContent" class="content-page">
                <!-- 專案標題區 -->
                <div class="project-header">
                    <div class="project-title-row">
                        <div>
                            <div class="project-title" id="detailProjectTitle">專案名稱</div>
                            <div class="project-code" id="detailProjectCode">專案編號：</div>
                        </div>
                        <div class="project-status">
                            <div class="status-badge-large status-active" id="detailProjectStatus">施工中</div>
                        </div>
                    </div>
                    
                    <div class="info-grid" id="detailInfoGrid">
                        <!-- 動態生成專案基本資訊 -->
                    </div>
                    
                    <div class="progress-section">
                        <div class="info-label">工程進度</div>
                        <div class="progress-bar-large">
                            <div class="progress-fill-large" id="detailProgressFill" style="width: 68%;"></div>
                        </div>
                        <div class="progress-text" id="detailProgressText">68% 完成 (按進度執行中)</div>
                    </div>
                </div>

                <!-- 標籤頁容器 -->
                <div class="tabs-container">
                    <div class="tabs-nav">
                        <button class="tab-btn active" onclick="switchTab(event, 'overview')">
                            專案概況
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'contracts')">
                            合約管理
                            <span class="tab-badge">1</span>
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'progress')">
                            工程進度
                            <span class="tab-badge">3</span>
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'materials')">
                            材料採購
                            <span class="tab-badge">2</span>
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'finance')">
                            財務管理
                            <span class="tab-badge">1</span>
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'changes')">
                            設計變更
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'drawings')">
                            圖面資料
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'timefiles')">
                            工時文件
                        </button>
                        <button class="tab-btn" onclick="switchTab(event, 'bonus')">
                            工作比例與獎金
                        </button>
                    </div>
                    
                    <div class="tab-content">
                        <!-- 專案概況 -->
                        <div id="overview" class="tab-panel active">
                            <h3>專案基本資訊</h3>
                            <p>這裡顯示專案的基本概況，包括專案描述、設計理念、專案地址、時程規劃等詳細資訊。</p>
                        </div>
                        
                        <!-- 合約管理 -->
                        <div id="contracts" class="tab-panel">
                            <h3>合約資訊</h3>
                            <p>這裡管理專案的合約資料，包括主合約資料、付款階段明細、合約變更記錄等。</p>
                        </div>
                        
                        <!-- 工程進度 -->
                        <div id="progress" class="tab-panel">
                            <h3>工程進度追蹤</h3>
                            <p>這裡追蹤各工程項目的進度，包括拆除工程、水電工程、泥作工程、木作工程、油漆工程等各階段進度。</p>
                        </div>
                        
                        <!-- 材料採購 -->
                        <div id="materials" class="tab-panel">
                            <h3>材料採購清單</h3>
                            <p>這裡管理專案所需的材料採購，包括主要材料清單、廠商報價比較、採購進度追蹤等。</p>
                        </div>
                        
                        <!-- 財務管理 -->
                        <div id="finance" class="tab-panel">
                            <h3>請款收款記錄</h3>
                            <p>這裡管理專案的財務狀況，包括請款明細、收款記錄、支出費用記錄、財務總覽等。</p>
                        </div>
                        
                        <!-- 設計變更 -->
                        <div id="changes" class="tab-panel">
                            <h3>設計變更記錄</h3>
                            <p>這裡記錄專案的設計變更歷史，包括變更原因、金額影響、工期影響、變更影響分析等。</p>
                        </div>
                        
                        <!-- 圖面資料 -->
                        <div id="drawings" class="tab-panel">
                            <h3>設計圖面資料</h3>
                            <p>這裡管理專案的設計圖面，包括平面配置圖、立面圖、天花板圖、3D模型、效果圖、施工圖說等各類圖面資料。</p>
                        </div>
                        
                        <!-- 工時文件 -->
                        <div id="timefiles" class="tab-panel">
                            <h3>工作時數統計</h3>
                            <p>這裡統計專案的工作時數，包括總工時統計、人員工時分配、本月工時、工作日誌等。</p>
                        </div>
                        
                        <!-- 工作比例與獎金 -->
                        <div id="bonus" class="tab-panel">
                            <h3>工作比例與獎金分配</h3>
                            <p>這裡管理專案的工作比例分配和獎金計算，包括設計師工作比例、助理工作比例、專案經理比例、獎金計算公式、績效評估等。</p>
                        </div>
                    </div>
                </div>
                
                <div class="page-actions" style="margin-top: 20px;">
                    <button class="btn" onclick="showPage('dashboard')">返回總覽</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全域變數
        let currentUser = null;
        let userPermissions = {};
        let currentProjectId = null;
        
        // 年份範圍配置 (方便未來擴展)
        const YEAR_RANGE = {
            start: 2021,
            end: 2026
        };
        
        // 專案資料 (擴展到2021-2026年)
        const projectsData = [
            // 2026年專案 (預計)
            {
                id: 'PRJ-2026-001',
                name: '未來科技辦公室',
                customer: '科技公司',
                designer: 'designer01',
                designerName: '王美窈',
                startDate: '2026-01-15',
                endDate: '2026-07-30',
                progress: 0,
                status: 'pending',
                statusText: '待續',
                year: '2026'
            },
            // 2025年專案
            {
                id: 'PRJ-2025-001',
                name: '台中建設辦公室裝修',
                customer: '張先生',
                designer: 'designer01',
                designerName: '王美窈',
                startDate: '2025-01-15',
                endDate: '2025-06-30',
                progress: 75,
                status: 'active',
                statusText: '進行中',
                year: '2025'
            },
            {
                id: 'PRJ-2025-002',
                name: '內湖住宅翻新設計',
                customer: '林小姐',
                designer: 'designer02',
                designerName: '李志豪',
                startDate: '2025-02-01',
                endDate: '2025-05-15',
                progress: 45,
                status: 'active',
                statusText: '進行中',
                year: '2025'
            },
            {
                id: 'PRJ-2025-003',
                name: '大安住宅裝修',
                customer: '陳女士',
                designer: 'designer01',
                designerName: '王美窈',
                startDate: '2025-01-20',
                endDate: '2025-04-20',
                progress: 30,
                status: 'active',
                statusText: '進行中',
                year: '2025'
            },
            {
                id: 'PRJ-2025-005',
                name: '松山區商辦設計',
                customer: '商辦業主',
                designer: 'designer02',
                designerName: '李志豪',
                startDate: '2025-01-05',
                endDate: '2025-03-15',
                progress: 100,
                status: 'completed',
                statusText: '已完成',
                year: '2025'
            },
            // 2024年專案
            {
                id: 'PRJ-2024-015',
                name: '南港辦公室設計',
                customer: '王董事長',
                designer: 'designer01',
                designerName: '王美窈',
                startDate: '2024-09-01',
                endDate: '2024-12-30',
                progress: 100,
                status: 'completed',
                statusText: '已完成',
                year: '2024'
            },
            {
                id: 'PRJ-2024-016',
                name: '板橋住宅翻修',
                customer: '黃小姐',
                designer: 'designer02',
                designerName: '李志豪',
                startDate: '2024-10-15',
                endDate: '2024-12-20',
                progress: 100,
                status: 'completed',
                statusText: '已完成',
                year: '2024'
            },
            {
                id: 'PRJ-2024-017',
                name: '中山區咖啡廳',
                customer: '咖啡店老闆',
                designer: 'designer03',
                designerName: '張雅婷',
                startDate: '2024-11-01',
                endDate: '2025-02-28',
                progress: 20,
                status: 'pending',
                statusText: '待續',
                year: '2024'
            },
            {
                id: 'PRJ-2024-018',
                name: '天母別墅設計',
                customer: '豪宅業主',
                designer: 'designer01',
                designerName: '王美窈',
                startDate: '2024-12-01',
                endDate: '2025-06-30',
                progress: 10,
                status: 'pending',
                statusText: '待續',
                year: '2024'
            },
            // 2023年專案
            {
                id: 'PRJ-2023-010',
                name: '松山區住宅設計',
                customer: '林董事長',
                designer: 'designer01',
                designerName: '王美窈',
                startDate: '2023-03-01',
                endDate: '2023-08-30',
                progress: 100,
                status: 'completed',
                statusText: '已完成',
                year: '2023'
            },
            {
                id: 'PRJ-2023-011',
                name: '信義區商場設計',
                customer: '商場業主',
                designer: 'designer02',
                designerName: '李志豪',
                startDate: '2023-05-15',
                endDate: '2023-12-20',
                progress: 100,
                status: 'completed',
                statusText: '已完成',
                year: '2023'
            },
            {
                id: 'PRJ-2023-012',
                name: '大直豪宅設計',
                customer: '豪宅業主',
                designer: 'designer03',
                designerName: '張雅婷',
                startDate: '2023-01-10',
                endDate: '2023-06-30',
                progress: 85,
                status: 'pending',
                statusText: '待續',
                year: '2023'
            },
            // 2022年專案
            {
                id: 'PRJ-2022-008',
                name: '中正區辦公室',
                customer: '科技公司',
                designer: 'designer01',
                designerName: '王美窈',
                startDate: '2022-06-01',
                endDate: '2022-11-30',
                progress: 100,
                status: 'completed',
                statusText: '已完成',
                year: '2022'
            },
            {
                id: 'PRJ-2022-009',
                name: '萬華區老屋翻新',
                customer: '老屋業主',
                designer: 'designer02',
                designerName: '李志豪',
                startDate: '2022-08-15',
                endDate: '2023-02-28',
                progress: 100,
                status: 'completed',
                statusText: '已完成',
                year: '2022'
            },
            // 2021年專案
            {
                id: 'PRJ-2021-005',
                name: '士林區住宅設計',
                customer: '住宅業主',
                designer: 'designer01',
                designerName: '王美窈',
                startDate: '2021-09-01',
                endDate: '2022-03-30',
                progress: 100,
                status: 'completed',
                statusText: '已完成',
                year: '2021'
            },
            {
                id: 'PRJ-2021-006',
                name: '北投區溫泉會館',
                customer: '溫泉業者',
                designer: 'designer03',
                designerName: '張雅婷',
                startDate: '2021-11-15',
                endDate: '2022-06-30',
                progress: 100,
                status: 'completed',
                statusText: '已完成',
                year: '2021'
            }
        ];
        
        // 審核資料
        const approvalData = [
            {
                id: 'APP-001',
                type: '進度更新',
                projectId: 'PRJ-2025-001',
                projectName: '台中建設辦公室裝修',
                applicant: '王美窈',
                applicantRole: '設計師',
                time: '2025-03-15 14:30',
                amount: null,
                status: 'review',
                statusText: '待審核',
                description: '水電工程進度更新至95%'
            },
            {
                id: 'APP-002',
                type: '請款申請',
                projectId: 'PRJ-2025-002',
                projectName: '內湖住宅翻新設計',
                applicant: '李志豪',
                applicantRole: '設計師',
                time: '2025-03-15 10:15',
                amount: 'NT$ 350,000',
                status: 'review',
                statusText: '待審核',
                description: '第二期工程款申請'
            },
            {
                id: 'APP-003',
                type: '設計變更',
                projectId: 'PRJ-2025-001',
                projectName: '台中建設辦公室裝修',
                applicant: '王美窈',
                applicantRole: '設計師',
                time: '2025-03-14 16:45',
                amount: 'NT$ 50,000',
                status: 'review',
                statusText: '待審核',
                description: '增加會議室隔音設施'
            },
            {
                id: 'APP-004',
                type: '材料採購',
                projectId: 'PRJ-2025-003',
                projectName: '大安住宅裝修',
                applicant: '張雅婷',
                applicantRole: '設計師',
                time: '2025-03-14 11:20',
                amount: 'NT$ 120,000',
                status: 'review',
                statusText: '待審核',
                description: '進口磁磚及衛浴設備採購'
            },
            {
                id: 'APP-005',
                type: '工時調整',
                projectId: 'PRJ-2025-004',
                projectName: '信義商辦設計',
                applicant: '黃小芳',
                applicantRole: '設計助理',
                time: '2025-03-13 15:30',
                amount: null,
                status: 'review',
                statusText: '待審核',
                description: '本月加班工時申請'
            }
        ];
        
        // 頁面載入時初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('專案管理系統載入中...');
            initializeUser();
            initializePage();
        });
        
        function initializeUser() {
            const userInfo = localStorage.getItem('userInfo');
            
            if (userInfo) {
                try {
                    currentUser = JSON.parse(userInfo);
                    document.getElementById('navUserInfo').textContent = `${currentUser.fullName} (${currentUser.role})`;
                } catch (e) {
                    setDefaultUser();
                }
            } else {
                setDefaultUser();
            }
            
            setUserPermissions();
        }
        
        function setDefaultUser() {
            currentUser = {
                fullName: '佐佐木賢',
                role: '管理者',
                department: '管理部'
            };
            document.getElementById('navUserInfo').textContent = `${currentUser.fullName} (${currentUser.role})`;
        }
        
        function setUserPermissions() {
            const role = currentUser.role;
            
            userPermissions = {
                canViewAllProjects: ['管理者', '老闆'].includes(role),
                canEditProjects: ['管理者'].includes(role),
                canApprove: ['管理者', '老闆', '會計主管'].includes(role),
                isDesigner: role.includes('設計'),
                isBoss: role === '老闆'
            };
        }
        
        function initializePage() {
            console.log('初始化頁面...');
            console.log('當前用戶：', currentUser);
            console.log('用戶權限：', userPermissions);
            
            generateYearGroups();
            loadDashboardData();
            loadApprovalData();
            updateProjectCounts();
            
            // 自動展開當前年份
            setTimeout(() => {
                const currentYear = new Date().getFullYear();
                toggleYear(currentYear.toString());
            }, 500);
        }
        
        // 動態生成年份組
        function generateYearGroups() {
            const container = document.getElementById('yearGroupsContainer');
            let yearGroupsHTML = '';
            
            for (let year = YEAR_RANGE.end; year >= YEAR_RANGE.start; year--) {
                const yearProjects = projectsData.filter(p => p.year === year.toString());
                const activeCount = yearProjects.filter(p => p.status === 'active').length;
                const completedCount = yearProjects.filter(p => p.status === 'completed').length;
                const pendingCount = yearProjects.filter(p => p.status === 'pending').length;
                const totalCount = yearProjects.length;
                
                yearGroupsHTML += `
                    <div class="year-group">
                        <div class="year-header" onclick="toggleYear('${year}')">
                            <span class="year-toggle" id="toggle-${year}">▶</span>
                            <span>${year}年</span>
                            <span class="menu-badge info">${totalCount}</span>
                        </div>
                        <div class="year-content" id="year-${year}">
                            <div class="status-group">
                                <div class="status-item" onclick="showProjectsByStatus('${year}', 'active')">
                                    <div class="status-icon active"></div>
                                    <span>進行中</span>
                                    <span class="menu-badge success">${activeCount}</span>
                                </div>
                                <div class="status-item" onclick="showProjectsByStatus('${year}', 'completed')">
                                    <div class="status-icon completed"></div>
                                    <span>已完成</span>
                                    <span class="menu-badge info">${completedCount}</span>
                                </div>
                                <div class="status-item" onclick="showProjectsByStatus('${year}', 'pending')">
                                    <div class="status-icon pending"></div>
                                    <span>待續</span>
                                    <span class="menu-badge warning">${pendingCount}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            container.innerHTML = yearGroupsHTML;
        }
        
        function loadDashboardData() {
            loadStatistics();
            loadRecentProjects();
            loadMyProjects();
        }
        
        function loadStatistics() {
            const statsGrid = document.getElementById('statsGrid');
            let stats = [];
            
            if (userPermissions.canViewAllProjects) {
                const activeProjects = projectsData.filter(p => p.status === 'active').length;
                const completedProjects = projectsData.filter(p => p.status === 'completed').length;
                const pendingProjects = projectsData.filter(p => p.status === 'pending').length;
                const avgProgress = Math.round(projectsData.reduce((sum, p) => sum + p.progress, 0) / projectsData.length);
                
                stats = [
                    { icon: '📋', iconClass: 'blue', value: activeProjects.toString(), label: '執行中專案', change: '+2 本月新增', changeClass: 'positive' },
                    { icon: '⚡', iconClass: 'green', value: `${avgProgress}%`, label: '平均進度', change: '+5% 較上月', changeClass: 'positive' },
                    { icon: '⏰', iconClass: 'yellow', value: pendingProjects.toString(), label: '延期專案', change: '需要關注', changeClass: 'negative' },
                    { icon: '✅', iconClass: 'purple', value: completedProjects.toString(), label: '已完成專案', change: '歷年累計', changeClass: 'positive' }
                ];
            } else if (userPermissions.isDesigner) {
                const myProjects = getMyProjects();
                const myAvgProgress = myProjects.length > 0 ? Math.round(myProjects.reduce((sum, p) => sum + p.progress, 0) / myProjects.length) : 0;
                
                stats = [
                    { icon: '📋', iconClass: 'blue', value: myProjects.length.toString(), label: '我的專案', change: '當前負責', changeClass: 'positive' },
                    { icon: '⚡', iconClass: 'green', value: `${myAvgProgress}%`, label: '平均進度', change: '表現良好', changeClass: 'positive' },
                    { icon: '📈', iconClass: 'purple', value: '85%', label: '考核分數', change: '本月表現', changeClass: 'positive' },
                    { icon: '📝', iconClass: 'yellow', value: '2', label: '待填寫項目', change: '請及時更新', changeClass: 'warning' }
                ];
            }
            
            statsGrid.innerHTML = stats.map(stat => `
                <div class="stat-card">
                    <div class="stat-header">
                        <div class="stat-icon ${stat.iconClass}">${stat.icon}</div>
                    </div>
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                    <div class="stat-change ${stat.changeClass}">${stat.change}</div>
                </div>
            `).join('');
        }
        
        function loadRecentProjects() {
            const recentProjectsList = document.getElementById('recentProjectsList');
            const recentProjects = projectsData.filter(p => p.status === 'active').slice(0, 5);
            
            recentProjectsList.innerHTML = recentProjects.map(project => `
                <tr>
                    <td>${project.id}</td>
                    <td>${project.name}</td>
                    <td>${project.customer}</td>
                    <td>${project.startDate}</td>
                    <td>${project.endDate}</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${project.progress}%;"></div>
                        </div>
                        <div class="progress-text">${project.progress}%</div>
                    </td>
                    <td><span class="status-badge status-${project.status}">${project.statusText}</span></td>
                    <td>
                        <button class="btn" onclick="viewProjectDetail('${project.id}')">檢視</button>
                    </td>
                </tr>
            `).join('');
        }
        
        function loadMyProjects() {
            const myProjects = getMyProjects();
            document.getElementById('myProjectsBadge').textContent = myProjects.length;
            
            const projectsList = document.getElementById('myProjectsList');
            if (projectsList) {
                projectsList.innerHTML = myProjects.map(project => `
                    <tr>
                        <td>${project.id}</td>
                        <td>${project.name}</td>
                        <td>${project.customer}</td>
                        <td>${project.startDate}</td>
                        <td>${project.endDate}</td>
                        <td>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${project.progress}%;"></div>
                            </div>
                            <div class="progress-text">${project.progress}%</div>
                        </td>
                        <td><span class="status-badge status-${project.status}">${project.statusText}</span></td>
                        <td>
                            <button class="btn" onclick="viewProjectDetail('${project.id}')">檢視</button>
                            ${userPermissions.isDesigner ? '<button class="btn btn-primary" onclick="updateProgress(\'' + project.id + '\')">更新進度</button>' : ''}
                        </td>
                    </tr>
                `).join('');
            }
        }
        
        function loadApprovalData() {
            const approvalList = document.getElementById('approvalList');
            document.getElementById('approvalBadge').textContent = approvalData.length;
            
            if (approvalList) {
                approvalList.innerHTML = approvalData.map(item => `
                    <tr>
                        <td>${item.type}</td>
                        <td>${item.projectName}</td>
                        <td>${item.applicant} (${item.applicantRole})</td>
                        <td>${item.time}</td>
                        <td>${item.amount || '-'}</td>
                        <td><span class="status-badge status-${item.status}">${item.statusText}</span></td>
                        <td>
                            <button class="btn btn-success btn-sm" onclick="approveItem('${item.id}')">同意</button>
                            <button class="btn btn-warning btn-sm" onclick="rejectItem('${item.id}')">退回</button>
                            <button class="btn btn-danger btn-sm" onclick="denyItem('${item.id}')">拒絕</button>
                        </td>
                    </tr>
                `).join('');
            }
        }
        
        function getMyProjects() {
            const username = localStorage.getItem('user') || 'designer01';
            
            if (userPermissions.canViewAllProjects) {
                return projectsData;
            } else if (userPermissions.isDesigner) {
                return projectsData.filter(project => project.designer === username);
            } else {
                return [];
            }
        }
        
        function updateProjectCounts() {
            document.getElementById('allProjectsBadge').textContent = projectsData.length;
        }
        
        // 年份摺疊功能
        function toggleYear(year) {
            const toggle = document.getElementById(`toggle-${year}`);
            const content = document.getElementById(`year-${year}`);
            
            if (content && toggle) {
                if (content.classList.contains('expanded')) {
                    content.classList.remove('expanded');
                    toggle.classList.remove('expanded');
                    toggle.textContent = '▶';
                } else {
                    content.classList.add('expanded');
                    toggle.classList.add('expanded');
                    toggle.textContent = '▼';
                }
            }
        }
        
        // 顯示特定年份和狀態的專案
        function showProjectsByStatus(year, status) {
            console.log(`顯示 ${year} 年 ${status} 狀態的專案`);
            
            // 清除所有active狀態
            document.querySelectorAll('.menu-item, .status-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 設置當前選中的狀態項目為active
            event.target.closest('.status-item').classList.add('active');
            
            // 篩選專案
            let filteredProjects = projectsData.filter(project => {
                return project.year === year && project.status === status;
            });
            
            // 如果不是管理者，只顯示自己的專案
            if (!userPermissions.canViewAllProjects && userPermissions.isDesigner) {
                const username = localStorage.getItem('user') || 'designer01';
                filteredProjects = filteredProjects.filter(project => project.designer === username);
            }
            
            // 隱藏所有內容
            hideAllContent();
            
            // 顯示年份狀態專案列表
            document.getElementById('yearStatusContent').classList.add('active');
            
            // 更新標題
            const statusMap = {
                'active': '進行中',
                'completed': '已完成',
                'pending': '待續'
            };
            
            document.getElementById('yearStatusTitle').textContent = `${year}年 ${statusMap[status]} 專案`;
            document.getElementById('yearStatusSubtitle').textContent = `共 ${filteredProjects.length} 個專案`;
            document.getElementById('yearStatusTableTitle').textContent = `${year}年 ${statusMap[status]} 專案列表`;
            
            // 載入專案列表
            const yearStatusProjectsList = document.getElementById('yearStatusProjectsList');
            yearStatusProjectsList.innerHTML = filteredProjects.map(project => `
                <tr>
                    <td>${project.id}</td>
                    <td>${project.name}</td>
                    <td>${project.customer}</td>
                    <td>${project.startDate}</td>
                    <td>${project.endDate}</td>
                    <td>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${project.progress}%;"></div>
                        </div>
                        <div class="progress-text">${project.progress}%</div>
                    </td>
                    <td><span class="status-badge status-${project.status}">${project.statusText}</span></td>
                    <td>
                        <button class="btn" onclick="viewProjectDetail('${project.id}')">檢視</button>
                        ${userPermissions.isDesigner && project.designer === (localStorage.getItem('user') || 'designer01') ? '<button class="btn btn-primary" onclick="updateProgress(\'' + project.id + '\')">更新進度</button>' : ''}
                    </td>
                </tr>
            `).join('');
        }
        
        // 查看專案詳情
        function viewProjectDetail(projectId) {
            console.log('查看專案詳情:', projectId);
            currentProjectId = projectId;
            const project = projectsData.find(p => p.id === projectId);
            
            if (!project) {
                alert('找不到專案資料');
                return;
            }
            
            // 清除所有active狀態
            document.querySelectorAll('.menu-item, .status-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 隱藏所有內容
            hideAllContent();
            
            // 顯示專案詳情
            document.getElementById('projectDetailContent').classList.add('active');
            
            // 載入專案詳情資料
            loadProjectDetailData(project);
        }
        
        function loadProjectDetailData(project) {
            // 更新專案標題資訊
            document.getElementById('detailProjectTitle').textContent = project.name;
            document.getElementById('detailProjectCode').textContent = `專案編號：${project.id}`;
            document.getElementById('detailProjectStatus').textContent = project.statusText;
            
            // 更新進度條
            const progressFill = document.getElementById('detailProgressFill');
            const progressText = document.getElementById('detailProgressText');
            progressFill.style.width = `${project.progress}%`;
            progressText.textContent = `${project.progress}% 完成 (按進度執行中)`;
            
            // 更新基本資訊網格
            const infoGrid = document.getElementById('detailInfoGrid');
            infoGrid.innerHTML = `
                <div class="info-card">
                    <div class="info-label">客戶名稱</div>
                    <div class="info-value">${project.customer}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">負責設計師</div>
                    <div class="info-value">${project.designerName}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">專案類別</div>
                    <div class="info-value">商業空間 / 辦公室</div>
                </div>
                <div class="info-card">
                    <div class="info-label">開始日期</div>
                    <div class="info-value">${project.startDate}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">預計完工</div>
                    <div class="info-value">${project.endDate}</div>
                </div>
                <div class="info-card">
                    <div class="info-label">合約金額</div>
                    <div class="info-value amount">NT$ 3,500,000</div>
                </div>
            `;
        }
        
        // 隱藏所有內容頁面
        function hideAllContent() {
            document.querySelectorAll('.content-page').forEach(page => {
                page.classList.remove('active');
            });
        }
        
        // 頁面切換功能
        function showPage(page) {
            console.log('切換到頁面:', page);
            
            // 移除所有active狀態
            document.querySelectorAll('.menu-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 設置當前頁面為active
            if (event && event.target) {
                event.target.closest('.menu-item').classList.add('active');
            }
            
            // 隱藏所有內容
            hideAllContent();
            
            // 顯示對應內容
            if (page === 'dashboard') {
                document.getElementById('dashboardContent').classList.add('active');
                loadDashboardData();
            } else if (page === 'projects') {
                document.getElementById('projectsContent').classList.add('active');
                loadMyProjects();
            } else if (page === 'approval') {
                document.getElementById('approvalContent').classList.add('active');
                loadApprovalData();
            } else {
                // 其他頁面顯示開發中訊息
                const pageMap = {
                    'allProjects': '所有專案',
                    'assignment': '專案分派'
                };
                
                alert(`切換到：${pageMap[page]}\n\n子系統功能開發中...`);
                
                // 恢復儀表板顯示
                document.getElementById('dashboardContent').classList.add('active');
                document.querySelector('.menu-item').classList.add('active');
            }
        }
        
        // 標籤頁切換功能
        function switchTab(event, tabName) {
            // 移除所有標籤頁的active狀態
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            // 設置當前標籤頁為active
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
        
        // 審核功能
        function approveItem(id) {
            if (confirm('確定要同意這個申請嗎？')) {
                const item = approvalData.find(item => item.id === id);
                if (item) {
                    alert(`已同意申請 ${id}\n申請類型：${item.type}\n申請人：${item.applicant}\n\n申請將進入下一個審核階段或完成處理`);
                    loadApprovalData();
                }
            }
        }
        
        function rejectItem(id) {
            const reason = prompt('請輸入退回原因：');
            if (reason) {
                const item = approvalData.find(item => item.id === id);
                if (item) {
                    alert(`已退回申請 ${id}\n退回原因：${reason}\n\n申請已退回給申請人修改`);
                    loadApprovalData();
                }
            }
        }
        
        function denyItem(id) {
            const reason = prompt('請輸入拒絕原因：');
            if (reason) {
                const item = approvalData.find(item => item.id === id);
                if (item) {
                    alert(`已拒絕申請 ${id}\n拒絕原因：${reason}\n\n申請已被正式拒絕`);
                    loadApprovalData();
                }
            }
        }
        
        // 快速操作功能
        function quickAction(action) {
            if (userPermissions.isBoss) {
                alert('您當前為查看模式，無法進行此操作');
                return;
            }
            
            const actionMap = {
                'newProject': '新增專案'
            };
            
            alert(`執行：${actionMap[action]}\n\n功能開發中...`);
        }
        
        function updateProgress(projectId) {
            alert(`更新專案進度：${projectId}\n\n將開啟進度更新表單...`);
        }
        
        // 導航功能
        function goBack() {
            if (confirm('確定要返回主控制台嗎？')) {
                try {
                    window.location.href = 'dashboard.html';
                } catch (e) {
                    alert('返回主控制台\n\n請確保dashboard.html檔案存在');
                }
            }
        }
        
        function goHome() {
            if (confirm('確定要返回主控制台嗎？')) {
                try {
                    window.location.href = 'dashboard.html';
                } catch (e) {
                    alert('返回主控制台\n\n請確保dashboard.html檔案存在');
                }
            }
        }
        
        function logout() {
            if (confirm('確定要登出系統嗎？')) {
                localStorage.removeItem('user');
                localStorage.removeItem('userInfo');
                try {
                    window.location.href = 'index.html';
                } catch (e) {
                    alert('已登出系統\n\n請手動導航至登入頁面');
                }
            }
        }
        
        // 動態年份擴展功能 (供未來使用)
        function addNewYear(year) {
            // 更新年份範圍
            if (year > YEAR_RANGE.end) {
                YEAR_RANGE.end = year;
            } else if (year < YEAR_RANGE.start) {
                YEAR_RANGE.start = year;
            }
            
            // 重新生成年份組
            generateYearGroups();
            updateProjectCounts();
            
            console.log(`已添加 ${year} 年到系統中`);
        }
    </script>
</body>
</html>
